{"version":3,"sources":["../../js/luke.js"],"names":["staticLocalJson","staticNameList","$","document","ready","init","loadStaffList","children","on","e","readStaffAttributes","index","css","modalHeight","window","height","find","val","focus","keydown","keyCode","addName","callback","getJSON","data","done","i","id","parseInt","target","getAttribute","attr","staff_auto_increment","removeAttr","removeClass","eq","addClass","list","staff_list","index_namelist","indexOf","name","career","type","absence","attack","control","element","alert","$staff_list","empty","each","item","push","elementNode","createElement","setAttribute","className","innerHTML","append","loadNameList","$name_select","Option","addStaff","increment","length","modal"],"mappings":"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","file":"luke.js","sourcesContent":["'use strict';\r\nlet staticLocalJson = null;\r\nlet staticNameList = [];\r\n$(document).ready(function () {\r\n    init(function () {\r\n        // init done\r\n        // load local\r\n        loadStaffList();\r\n    });\r\n\r\n    // bind event\r\n    $(\"#staff_list\").children(\"div\").on(\"click\", \"button\", function (e) {\r\n        readStaffAttributes(e, $(this).index());\r\n    });\r\n\r\n    // modal\r\n    $('#modal_add_name').on('show.bs.modal', function (e) {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('#modal_add_name').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    });\r\n    $(\"#modal_add_name\").on(\"shown.bs.modal\", function (e) {\r\n        $(\"#modal_add_name_input\").val('');\r\n        $(\"#modal_add_name_input\").focus();\r\n        $('#modal_add_name_input').keydown(function (e) {\r\n            if (e.keyCode === 13) {\r\n                addName();\r\n            }\r\n        });\r\n    });\r\n});\r\n\r\n/**\r\n * load local config file\r\n * @param callback called on completion\r\n */\r\nfunction init(callback) {\r\n    $.getJSON(\"data/luke_config.json\", function (data) {\r\n        if (data == null) {\r\n            return;\r\n        }\r\n        staticLocalJson = data;\r\n    }).done(callback);\r\n}\r\n\r\nfunction readStaffAttributes(e, i) {\r\n    let id = parseInt(e.target.getAttribute(\"data-id\"));\r\n    $(\"#staff_attr_panel\").attr(\"data-id\", id);\r\n    // new staff\r\n    if (id === staticLocalJson.staff_auto_increment) {\r\n        // reset attributes group\r\n        $(\"#staff_attr_name_select\").val(-1);\r\n        $(\"#staff_attr_career_input\").val(\"\");\r\n        $(\"#staff_attr_type_select\").val(0);\r\n        $(\"#staff_attr_absence_check\").removeAttr(\"checked\");\r\n        $(\"#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        $(\"#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        $(\"#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        return;\r\n    }\r\n    // read local attributes\r\n    let list = staticLocalJson.staff_list;\r\n    if (list[i].id === id) {\r\n        // main attributes\r\n        let index_namelist = staticNameList.indexOf(list[i].name);\r\n        $(\"#staff_attr_name_select\").val(index_namelist);\r\n        $(\"#staff_attr_career_input\").val(list[i].career);\r\n        $(\"#staff_attr_type_select\").val(list[i].type);\r\n        if (list[i].absence) {\r\n            $(\"#staff_attr_absence_check\").attr(\"checked\", \"checked\");\r\n        } else {\r\n            $(\"#staff_attr_absence_check\").removeAttr(\"checked\");\r\n        }\r\n        // other attributes\r\n        $(\"#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(list[i].attack - 1).addClass(\"active\");\r\n        $(\"#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(list[i].control - 1).addClass(\"active\");\r\n        $(\"#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(list[i].element - 1).addClass(\"active\");\r\n    } else {\r\n        // Error 600:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        // TODO\r\n        alert(\"错误代码600，请告知小明\");\r\n    }\r\n}\r\n\r\nfunction loadStaffList() {\r\n    let $staff_list = $(\"#staff_list\").children(\"div\");\r\n    $staff_list.empty();\r\n    $.each(staticLocalJson.staff_list, function (index, item) {\r\n        // load name list\r\n        if (staticNameList.indexOf(item.name) === -1) {\r\n            staticNameList.push(item.name);\r\n        }\r\n\r\n        // load staff\r\n        let elementNode = document.createElement(\"button\");\r\n        elementNode.setAttribute(\"type\", \"button\");\r\n        elementNode.setAttribute(\"data-id\", item.id);\r\n        elementNode.className = \"btn btn-default\";\r\n        elementNode.innerHTML = item.name + item.career;\r\n        if (item.absence) {\r\n            elementNode.className += \" career-absence\";\r\n        } else if (item.type === 1) {\r\n            elementNode.className += \" career-c\";\r\n        } else if (item.type === 2) {\r\n            elementNode.className += \" career-assist\";\r\n        } else {\r\n            elementNode.className += \" career-priest\";\r\n        }\r\n        $staff_list.append(elementNode);\r\n    });\r\n    loadNameList()\r\n}\r\n\r\nfunction loadNameList() {\r\n    let $name_select = $(\"#staff_attr_name_select\");\r\n    $name_select.empty();\r\n    $name_select.append(new Option(\"称谓\", \"-1\"));\r\n    $.each(staticNameList, function (index, item) {\r\n        $name_select.append(new Option(item, index));\r\n    });\r\n}\r\n\r\nfunction addStaff() {\r\n    let increment = staticLocalJson.staff_auto_increment;\r\n    let elementNode = document.createElement(\"button\");\r\n    elementNode.setAttribute(\"type\", \"button\");\r\n    elementNode.setAttribute(\"data-id\", increment);\r\n    elementNode.className = \"btn btn-default\";\r\n    elementNode.innerHTML = \"新增人员\";\r\n    $(\"#staff_list\").children(\"div\").append(elementNode);\r\n}\r\n\r\nfunction addName() {\r\n    let name = $(\"#modal_add_name_input\").val();\r\n    if (name === null) {\r\n        return\r\n    }\r\n    staticNameList.push(name);\r\n    loadNameList();\r\n    $(\"#staff_attr_name_select\").val(staticNameList.length - 1);\r\n    $(\"#modal_add_name\").modal('hide');\r\n}"]}