{"version":3,"sources":["../../js/luke.js"],"names":["staticLocalJson","staticNameList","$","document","ready","init","loadStaffList","popover","content","placement","trigger","click","addStaff","blur","saveStaff","deleteStaff","children","on","e","readStaffAttributes","index","window","onbeforeunload","saveToLocal","find","console","log","css","modalHeight","height","focus","keydown","keyCode","addName","val","callback","getJSON","data","done","i","id","parseInt","target","getAttribute","attr","staff_auto_increment","prop","removeClass","eq","addClass","list","staff_list","index_namelist","indexOf","name","career","type","absence","attack","control","element","alert","$staff_list","empty","each","item","push","elementNode","createElement","setAttribute","className","innerHTML","append","loadNameList","$name_select","Option","$btn_list","increment","exist","is","toString","trim","$modal","modal","length","$staff_btn","staff","text","remove","splice","dataToStore","JSON","stringify","ajax","method","url","async"],"mappings":"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","file":"luke.js","sourcesContent":["'use strict';\r\nlet staticLocalJson = {\r\n    \"staff_auto_increment\": 0,\r\n    \"staff_list\": []\r\n};\r\nlet staticNameList = [];\r\n$(document).ready(function () {\r\n    init(function () {\r\n        // init done\r\n        // load local\r\n        loadStaffList();\r\n    });\r\n\r\n    // init popover\r\n    $(\"#staff_list_add_btn\").popover({\r\n        content: \"一次只能新增一个空白团员\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).click(addStaff).blur(function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"#staff_attr_save_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).click(saveStaff).blur(function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"#staff_attr_del_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).click(deleteStaff).blur(function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    // bind event\r\n    $(\"#staff_list\").children(\"div\").on(\"click\", \"button\", function (e) {\r\n        readStaffAttributes(e, $(this).index());\r\n    });\r\n    window.onbeforeunload = saveToLocal;\r\n    $(\"#staff_list_filter\").find('input').click(function () {\r\n       console.log(\"changed\");\r\n    });\r\n\r\n    // modal\r\n    $('#modal_add_name').on('show.bs.modal', function () {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('#modal_add_name').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    }).on(\"shown.bs.modal\", function () {\r\n        $(\"#modal_add_name_input\").focus();\r\n    });\r\n    $(\"#modal_add_name_input\").keydown(function (e) {\r\n        if (e.keyCode === 13) {\r\n            addName();\r\n            $(this).val('');\r\n        }\r\n    });\r\n});\r\n\r\n/**\r\n * load local config file\r\n * @param callback called on completion\r\n */\r\nfunction init(callback) {\r\n    $.getJSON(\"data/luke_config.json\", function (data) {\r\n        if (data == null) {\r\n            return;\r\n        }\r\n        staticLocalJson = data;\r\n    }).done(callback);\r\n}\r\n\r\nfunction readStaffAttributes(e, i) {\r\n    let id = parseInt(e.target.getAttribute(\"data-id\"));\r\n    $(\"#staff_attr_panel\").attr(\"data-id\", id);\r\n    // new staff\r\n    if (id === staticLocalJson.staff_auto_increment) {\r\n        // reset attributes group\r\n        $(\"#staff_attr_name_select\").val(-1);\r\n        $(\"#staff_attr_career_input\").val(\"\");\r\n        $(\"#staff_attr_type_select\").val(0);\r\n        $(\"#staff_attr_absence_check\").prop(\"checked\", false);\r\n        $(\"#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        $(\"#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        $(\"#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        return;\r\n    }\r\n    // read local attributes\r\n    let list = staticLocalJson.staff_list;\r\n    if (list[i].id === id) {\r\n        // main attributes\r\n        let index_namelist = staticNameList.indexOf(list[i].name);\r\n        $(\"#staff_attr_name_select\").val(index_namelist);\r\n        $(\"#staff_attr_career_input\").val(list[i].career);\r\n        $(\"#staff_attr_type_select\").val(list[i].type);\r\n        $(\"#staff_attr_absence_check\").prop(\"checked\", list[i].absence);\r\n        // other attributes\r\n        $(\"#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(list[i].attack - 1).addClass(\"active\");\r\n        $(\"#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(list[i].control - 1).addClass(\"active\");\r\n        $(\"#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(list[i].element - 1).addClass(\"active\");\r\n    } else {\r\n        console.log(i+' '+list[i].id+' '+id);\r\n        // Error 600:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        alert(\"错误代码600，请告知小明\");\r\n    }\r\n}\r\n\r\nfunction loadStaffList() {\r\n    let $staff_list = $(\"#staff_list\").children(\"div\");\r\n    $staff_list.empty();\r\n    $.each(staticLocalJson.staff_list, function (index, item) {\r\n        // load name list\r\n        if (staticNameList.indexOf(item.name) === -1) {\r\n            staticNameList.push(item.name);\r\n        }\r\n\r\n        // load staff\r\n        let elementNode = document.createElement(\"button\");\r\n        elementNode.setAttribute(\"type\", \"button\");\r\n        elementNode.setAttribute(\"data-id\", item.id);\r\n        elementNode.className = \"btn btn-default\";\r\n        elementNode.innerHTML = item.name + item.career;\r\n        if (item.absence) {\r\n            elementNode.className += \" career-absence\";\r\n        } else if (item.type === 1) {\r\n            elementNode.className += \" career-c\";\r\n        } else if (item.type === 2) {\r\n            elementNode.className += \" career-assist\";\r\n        } else {\r\n            elementNode.className += \" career-priest\";\r\n        }\r\n        $staff_list.append(elementNode);\r\n    });\r\n    loadNameList();\r\n}\r\n\r\nfunction loadNameList() {\r\n    let $name_select = $(\"#staff_attr_name_select\");\r\n    $name_select.empty();\r\n    $name_select.append(new Option(\"称谓\", \"-1\"));\r\n    $.each(staticNameList, function (index, item) {\r\n        $name_select.append(new Option(item, index));\r\n    });\r\n}\r\n\r\nfunction addStaff() {\r\n    let $btn_list = $(\"#staff_list\").children('div');\r\n    let increment = staticLocalJson.staff_auto_increment;\r\n    let exist = $btn_list.children(\"button\").is(\"[data-id=\" + increment + \"]\");\r\n    if (exist) {\r\n        $(\"#staff_list_add_btn\").popover('show');\r\n        return;\r\n    }\r\n    let elementNode = document.createElement(\"button\");\r\n    elementNode.setAttribute(\"type\", \"button\");\r\n    elementNode.setAttribute(\"data-id\", increment.toString());\r\n    elementNode.className = \"btn btn-default\";\r\n    elementNode.innerHTML = \"新增人员\";\r\n    $btn_list.append(elementNode);\r\n}\r\n\r\nfunction addName() {\r\n    let name = $(\"#modal_add_name_input\").val().trim();\r\n    let $modal = $(\"#modal_add_name\");\r\n    if (name === null || name === '') {\r\n        $modal.modal('hide');\r\n        return;\r\n    }\r\n    staticNameList.push(name);\r\n    loadNameList();\r\n    $(\"#staff_attr_name_select\").val(staticNameList.length - 1);\r\n    $modal.modal('hide');\r\n}\r\n\r\nfunction saveStaff() {\r\n    let id = parseInt($(\"#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $('#staff_attr_save_btn').popover('show');\r\n        return;\r\n    }\r\n    // read staff\r\n    let staff = {\r\n        \"id\": id,\r\n        \"name\": staticNameList[parseInt($(\"#staff_attr_name_select\").val())],\r\n        \"career\": $(\"#staff_attr_career_input\").val().trim(),\r\n        \"type\": parseInt($(\"#staff_attr_type_select\").val()),\r\n        \"absence\": $(\"#staff_attr_absence_check\").prop('checked'),\r\n        \"attack\": $(\"#staff_attr_other_attack\").find('label.active').index() + 1,\r\n        \"control\": $(\"#staff_attr_other_control\").find('label.active').index() + 1,\r\n        \"element\": $(\"#staff_attr_other_element\").find('label.active').index() + 1\r\n    };\r\n    if (staff.id === staticLocalJson.staff_auto_increment) { // new staff\r\n        // save to cache\r\n        staticLocalJson.staff_list.push(staff);\r\n        staticLocalJson.staff_auto_increment++;\r\n    } else { // old staff\r\n        let index = $staff_btn.index();\r\n        if (staticLocalJson.staff_list[index].id === staff.id) {\r\n            staticLocalJson.staff_list[index] = staff;\r\n        } else {\r\n            // Error 601:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n            alert(\"错误代码601，请告知小明\");\r\n        }\r\n    }\r\n    // refresh staff button\r\n    $staff_btn.text(staff.name + staff.career);\r\n    if (staff.absence) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-absence\");\r\n    } else if (staff.type === 1) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-c\");\r\n    } else if (staff.type === 2) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-assist\");\r\n    } else if (staff.type === 3) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-priest\");\r\n    } else {\r\n        $staff_btn.attr(\"class\", \"btn btn-default\");\r\n    }\r\n}\r\n\r\nfunction deleteStaff() {\r\n    let id = parseInt($(\"#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $('#staff_attr_del_btn').popover('show');\r\n        return;\r\n    }\r\n\r\n    let index = $staff_btn.index();\r\n    // delete btn\r\n    $staff_btn.remove();\r\n    if (staticLocalJson.staff_auto_increment === id) {// newly added\r\n        return;\r\n    }\r\n    // delete from static json\r\n    if (staticLocalJson.staff_list[index].id === id) {\r\n        staticLocalJson.staff_list.splice(index, 1);\r\n    } else {\r\n        // Error 602:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        alert(\"错误代码602，请告知小明\");\r\n    }\r\n}\r\n\r\nfunction saveToLocal() {\r\n    let dataToStore = JSON.stringify(staticLocalJson);\r\n    $.ajax({\r\n        method: 'post',\r\n        url: 'php/saveJSON.php',\r\n        async: false,// important\r\n        data: {\r\n            'toStore': dataToStore\r\n        }\r\n    }).done(function (data) {\r\n        console.log(data + ' characters saved');\r\n    });\r\n}"]}