{"version":3,"sources":["../../js/luke.js"],"names":["staticLocalJson","staticNameList","$","document","ready","init","loadStaffList","initPopovers","bindEvents","bindDrawLine","makeDraggable","on","css","modalHeight","window","height","find","focus","e","keyCode","addName","val","callback","getJSON","data","done","popover","content","placement","trigger","addStaff","saveStaff","deleteStaff","children","console","log","readStaffAttributes","index","onbeforeunload","saveToLocal","type","attr","className","parent","hasClass","show","hide","i","id","parseInt","target","getAttribute","staff_auto_increment","prop","removeClass","eq","addClass","list","staff_list","index_namelist","indexOf","name","career","absence","attack","control","element","alert","$staff_list","empty","each","item","push","elementNode","createElement","setAttribute","innerHTML","append","loadNameList","$name_select","Option","$btn_list","increment","exist","is","toString","trim","$modal","modal","length","$staff_btn","staff","text","remove","splice","dataToStore","JSON","stringify","ajax","method","url","async","$object","$handle","jQuery","isMove","X","Y","pageX","pageY","left","top","width","body","scrollWidth","scrollHeight","staffId","isDraw","isDrop","$buttons","x1","y1","x2","y2"],"mappings":"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","file":"luke.js","sourcesContent":["'use strict';\r\nlet staticLocalJson = {\r\n    \"staff_auto_increment\": 0,\r\n    \"staff_list\": []\r\n};\r\nlet staticNameList = [];\r\n$(document).ready(function () {\r\n    init(function () {\r\n        // init done\r\n        // load local\r\n        loadStaffList();\r\n    });\r\n\r\n    // init popovers\r\n    initPopovers();\r\n\r\n    // bind events\r\n    bindEvents();\r\n\r\n    // bind draw line\r\n    bindDrawLine();\r\n\r\n    // make draggable\r\n    makeDraggable($('#staff_list'), $(\"#staff_list_move_handle\"));\r\n\r\n    // modal\r\n    $('#modal_add_name').on('show.bs.modal', function () {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('#modal_add_name').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    }).on(\"shown.bs.modal\", function () {\r\n        $(\"#modal_add_name_input\").focus();\r\n    });\r\n    $(\"#modal_add_name_input\").on('keydown', function (e) {\r\n        if (e.keyCode === 13) {\r\n            addName();\r\n            $(this).val('');\r\n        }\r\n    });\r\n});\r\n\r\n/**\r\n * load local config file\r\n * @param callback called on completion\r\n */\r\nfunction init(callback) {\r\n    $.getJSON(\"data/luke_config.json\", function (data) {\r\n        if (data == null) {\r\n            return;\r\n        }\r\n        staticLocalJson = data;\r\n    }).done(callback);\r\n}\r\n\r\n/**\r\n * init popovers\r\n */\r\nfunction initPopovers() {\r\n    $(\"#staff_list_add_btn\").popover({\r\n        content: \"一次只能新增一个空白团员\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', addStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"#staff_attr_save_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', saveStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"#staff_attr_del_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', deleteStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n}\r\n\r\n/**\r\n * bind events\r\n */\r\nfunction bindEvents() {\r\n    // click on a staff button to read its attributes\r\n    $(\"#staff_list\").children(\"div\").on('click', 'button', function (e) {\r\n        console.log('click button');\r\n        readStaffAttributes(e, $(this).index());\r\n    });\r\n\r\n    // save data on leaving\r\n    window.onbeforeunload = saveToLocal;\r\n\r\n    // filter staff\r\n    $(\"#staff_list_filter\").find(\"input[name='options']\").on('change', function () {\r\n        let type = $(this).attr(\"data-filter\");\r\n        let className;\r\n        if (type === '1') {\r\n            className = '.career-c';\r\n        } else if (type === '2') {\r\n            className = '.career-assist';\r\n        } else if (type === '3') {\r\n            className = '.career-priest';\r\n        } else if (type === '4') {\r\n            className = '.in-schedule';\r\n        } else {\r\n            className = '.career-absence';\r\n        }\r\n        if ($(this).parent().hasClass('active')) {\r\n            // show\r\n            $(\"#staff_list\").children('div').find(className).show();\r\n        } else {\r\n            // hide\r\n            $(\"#staff_list\").children('div').find(className).hide();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * when a staff button is clicked, load his attributes\r\n * @param e event object\r\n * @param i index of that button\r\n */\r\nfunction readStaffAttributes(e, i) {\r\n    let id = parseInt(e.target.getAttribute(\"data-id\"));\r\n    $(\"#staff_attr_panel\").attr(\"data-id\", id);\r\n    // new staff\r\n    if (id === staticLocalJson.staff_auto_increment) {\r\n        // reset attributes group\r\n        $(\"#staff_attr_name_select\").val(-1);\r\n        $(\"#staff_attr_career_input\").val(\"\");\r\n        $(\"#staff_attr_type_select\").val(0);\r\n        $(\"#staff_attr_absence_check\").prop(\"checked\", false);\r\n        $(\"#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        $(\"#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        $(\"#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        return;\r\n    }\r\n    // read local attributes\r\n    let list = staticLocalJson.staff_list;\r\n    if (list[i].id === id) {\r\n        // main attributes\r\n        let index_namelist = staticNameList.indexOf(list[i].name);\r\n        $(\"#staff_attr_name_select\").val(index_namelist);\r\n        $(\"#staff_attr_career_input\").val(list[i].career);\r\n        $(\"#staff_attr_type_select\").val(list[i].type);\r\n        $(\"#staff_attr_absence_check\").prop(\"checked\", list[i].absence);\r\n        // other attributes\r\n        $(\"#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(list[i].attack - 1).addClass(\"active\");\r\n        $(\"#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(list[i].control - 1).addClass(\"active\");\r\n        $(\"#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(list[i].element - 1).addClass(\"active\");\r\n    } else {\r\n        console.log(i + ' ' + list[i].id + ' ' + id);\r\n        // Error 600:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        alert(\"错误代码600，请告知小明\");\r\n    }\r\n}\r\n\r\n/**\r\n * load staff list on the left from local json\r\n */\r\nfunction loadStaffList() {\r\n    let $staff_list = $(\"#staff_list\").children(\"div\");\r\n    $staff_list.empty();\r\n    $.each(staticLocalJson.staff_list, function (index, item) {\r\n        // load name list\r\n        if (staticNameList.indexOf(item.name) === -1) {\r\n            staticNameList.push(item.name);\r\n        }\r\n\r\n        // load staff\r\n        let elementNode = document.createElement(\"button\");\r\n        elementNode.setAttribute(\"type\", \"button\");\r\n        elementNode.setAttribute(\"data-id\", item.id);\r\n        elementNode.className = \"btn btn-default\";\r\n        elementNode.innerHTML = item.name + item.career;\r\n        if (item.type === 1) {\r\n            elementNode.className += \" career-c\";\r\n        } else if (item.type === 2) {\r\n            elementNode.className += \" career-assist\";\r\n        } else {\r\n            elementNode.className += \" career-priest\";\r\n        }\r\n        if (item.absence) {\r\n            elementNode.className += \" career-absence\";\r\n        }\r\n        $staff_list.append(elementNode);\r\n    });\r\n    loadNameList();\r\n}\r\n\r\n/**\r\n * create name select widget from static list\r\n */\r\nfunction loadNameList() {\r\n    let $name_select = $(\"#staff_attr_name_select\");\r\n    $name_select.empty();\r\n    $name_select.append(new Option(\"称谓\", \"-1\"));\r\n    $.each(staticNameList, function (index, item) {\r\n        $name_select.append(new Option(item, index));\r\n    });\r\n}\r\n\r\n/**\r\n * add a blank staff button\r\n */\r\nfunction addStaff() {\r\n    let $btn_list = $(\"#staff_list\").children('div');\r\n    let increment = staticLocalJson.staff_auto_increment;\r\n    let exist = $btn_list.children(\"button\").is(\"[data-id=\" + increment + \"]\");\r\n    if (exist) {\r\n        $(\"#staff_list_add_btn\").popover('show');\r\n        return;\r\n    }\r\n    let elementNode = document.createElement(\"button\");\r\n    elementNode.setAttribute(\"type\", \"button\");\r\n    elementNode.setAttribute(\"data-id\", increment.toString());\r\n    elementNode.className = \"btn btn-default\";\r\n    elementNode.innerHTML = \"新增人员\";\r\n    $btn_list.append(elementNode);\r\n}\r\n\r\n/**\r\n * add a new staff name to static list\r\n * and reload the name select widget\r\n */\r\nfunction addName() {\r\n    let name = $(\"#modal_add_name_input\").val().trim();\r\n    let $modal = $(\"#modal_add_name\");\r\n    if (name === null || name === '') {\r\n        $modal.modal('hide');\r\n        return;\r\n    }\r\n    staticNameList.push(name);\r\n    loadNameList();\r\n    $(\"#staff_attr_name_select\").val(staticNameList.length - 1);\r\n    $modal.modal('hide');\r\n}\r\n\r\n/**\r\n * save the attribute changes to local\r\n * and refresh the corresponding button\r\n */\r\nfunction saveStaff() {\r\n    let id = parseInt($(\"#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $('#staff_attr_save_btn').popover('show');\r\n        return;\r\n    }\r\n    // read staff\r\n    let staff = {\r\n        \"id\": id,\r\n        \"name\": staticNameList[parseInt($(\"#staff_attr_name_select\").val())],\r\n        \"career\": $(\"#staff_attr_career_input\").val().trim(),\r\n        \"type\": parseInt($(\"#staff_attr_type_select\").val()),\r\n        \"absence\": $(\"#staff_attr_absence_check\").prop('checked'),\r\n        \"attack\": $(\"#staff_attr_other_attack\").find('label.active').index() + 1,\r\n        \"control\": $(\"#staff_attr_other_control\").find('label.active').index() + 1,\r\n        \"element\": $(\"#staff_attr_other_element\").find('label.active').index() + 1\r\n    };\r\n    if (staff.id === staticLocalJson.staff_auto_increment) { // new staff\r\n        // save to cache\r\n        staticLocalJson.staff_list.push(staff);\r\n        staticLocalJson.staff_auto_increment++;\r\n    } else { // old staff\r\n        let index = $staff_btn.index();\r\n        if (staticLocalJson.staff_list[index].id === staff.id) {\r\n            staticLocalJson.staff_list[index] = staff;\r\n        } else {\r\n            // Error 601:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n            alert(\"错误代码601，请告知小明\");\r\n        }\r\n    }\r\n    // refresh staff button\r\n    $staff_btn.text(staff.name + staff.career);\r\n    if (staff.type === 1) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-c\");\r\n    } else if (staff.type === 2) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-assist\");\r\n    } else if (staff.type === 3) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-priest\");\r\n    } else {\r\n        $staff_btn.attr(\"class\", \"btn btn-default\");\r\n    }\r\n    if (staff.absence) {\r\n        $staff_btn.addClass(\"career-absence\");\r\n    }\r\n}\r\n\r\n/**\r\n * delete the corresponding staff button both from page and static json\r\n */\r\nfunction deleteStaff() {\r\n    let id = parseInt($(\"#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $('#staff_attr_del_btn').popover('show');\r\n        return;\r\n    }\r\n\r\n    let index = $staff_btn.index();\r\n    // delete btn\r\n    $staff_btn.remove();\r\n    if (staticLocalJson.staff_auto_increment === id) {// newly added\r\n        return;\r\n    }\r\n    // delete from static json\r\n    if (staticLocalJson.staff_list[index].id === id) {\r\n        staticLocalJson.staff_list.splice(index, 1);\r\n    } else {\r\n        // Error 602:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        alert(\"错误代码602，请告知小明\");\r\n    }\r\n}\r\n\r\n/**\r\n * save all changes to local .json file\r\n */\r\nfunction saveToLocal() {\r\n    let dataToStore = JSON.stringify(staticLocalJson);\r\n    $.ajax({\r\n        method: 'post',\r\n        url: 'php/saveJSON.php',\r\n        async: false,// important\r\n        data: {\r\n            'toStore': dataToStore\r\n        }\r\n    }).done(function (data) {\r\n        console.log(data + ' characters saved');\r\n    });\r\n}\r\n\r\n/**\r\n * make the corresponding dom draggable\r\n * @param $object jquery selector, object to be dragged\r\n * @param $handle the move handle\r\n */\r\nfunction makeDraggable($object, $handle) {\r\n    if (!$object instanceof jQuery) {\r\n        return;\r\n    }\r\n    let isMove = false;\r\n    let X, Y;\r\n    $handle.on('mousedown', function (e) {\r\n        isMove = true;\r\n        X = e.pageX - parseInt($object.css(\"left\"));\r\n        Y = e.pageY - parseInt($object.css(\"top\"));\r\n    });\r\n    $(document).on('mousemove', function (e) {\r\n        if (isMove) {\r\n            let left = e.pageX - X;\r\n            let top = e.pageY - Y;\r\n            $object.css({left: left, top: top});\r\n        }\r\n    }).on('mouseup', function () {\r\n        isMove = false;\r\n    });\r\n}\r\n\r\n/**\r\n * when drag event happening on a staff button, draw a line from start to end\r\n * if the dragging ends within the schedule chart, fill the cell with the staff\r\n */\r\nfunction bindDrawLine() {\r\n    // reinitialize svg width & height\r\n    $('.line').css({width: document.body.scrollWidth, height: document.body.scrollHeight});\r\n    // bind\r\n    let staffId;\r\n    let isDraw = false, isDrop = false;\r\n    // pick staff\r\n    let $buttons = $(\"#staff_list\").children('div');\r\n    $buttons.on('mousedown', 'button', function (e) {\r\n        console.log('down button');\r\n        // unlock drawing\r\n        isDraw = true;\r\n        // read staff id\r\n        staffId = parseInt($(e.target).attr('data-id'));\r\n        // draw a line\r\n        $('svg').show().children('line').attr({x1: e.pageX, y1: e.pageY, x2: e.pageX, y2: e.pageY});\r\n    });\r\n    // draw line\r\n    $(document).on('mousemove', function (e) {\r\n        if (isDraw) {\r\n            // draw a line\r\n            $('svg').children('line').attr({x2: e.pageX, y2: e.pageY});\r\n        }\r\n    }).on('mouseup', function () {\r\n        console.log('up document');\r\n        if (isDraw) {\r\n            isDraw = false;\r\n            $('svg').hide();\r\n\r\n            isDrop = true;\r\n        }\r\n    });\r\n    // drop staff\r\n    $('table tr td').on('mouseover', function () {\r\n        if (isDrop) {\r\n            let staff = staticLocalJson.staff_list[staffId - 1];\r\n            if (staff.id === staffId) {\r\n                // fill in the cell\r\n                $(this).attr({'data-name': staff.name}).text(staff.name + staff.career);\r\n                // hide source\r\n\r\n            }\r\n            isDrop = false;\r\n        }\r\n    });\r\n}"]}