{"version":3,"sources":["../../js/luke.js"],"names":["staticLocalJson","staticLocalChart","staticNameList","$","document","ready","init","loadStaffList","$schedule","html","loadCheck","children","text","Date","toLocaleDateString","replace","initPopovers","bindEvents","bindDrawLine","sessionStorage","authorized","modal","bootstrapSwitch","state","$chart","find","show","hide","makeDraggable","callback","count","getJSON","data","done","get","popover","content","placement","trigger","on","addStaff","saveStaff","deleteStaff","e","readStaffAttributes","index","window","onbeforeunload","saveToLocal","filterStaff","type","keyCode","$list","key","val","filter","$cell","removeClass","addClass","css","modalHeight","height","focus","addName","checkAuth","alphabet","time","$table","parentsUntil","length","append","resizeSVG","$tr","eq","remove","insertBefore","console","log","html2canvas","then","canvas","attr","toDataURL","experience","code","trim","$enter","$help","result","md5","auth_pre","prop","auth_fun","authorize","i","id","parseInt","target","getAttribute","staff_auto_increment","list","staff_list","index_namelist","indexOf","name","career","absence","attack","control","element","alert","$staff_list","empty","each","item","push","elementNode","createElement","setAttribute","className","innerHTML","loadNameList","$name_select","Option","$staff","$target","hasClass","removeAttr","filterConditions","$filterInputs","parent","$btn_list","increment","exist","is","toString","$input","$modal","$staff_btn","staff","splice","ajax","method","url","async","dataToStore","JSON","stringify","$object","$handle","jQuery","isMove","X","Y","pageX","pageY","left","top","width","body","scrollWidth","scrollHeight","isDraw","isDrop","isExchange","$svg","staffId","$td","$buttons","x1","y1","x2","y2","setTimeout","staff_name","staff_text","this_name","this_text","markDuplicate","staff_out_text","$contain","$staff_in","scale","arguments","$obj","map"],"mappings":"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","file":"luke.js","sourcesContent":["'use strict';\r\nlet staticLocalJson = {\r\n    \"staff_auto_increment\": 0,\r\n    \"staff_list\": [],\r\n    \"auth_pre\": \"\",\r\n    \"auth_fun\": \"\"\r\n};\r\nlet staticLocalChart = null;\r\nlet staticNameList = [];\r\n$(document).ready(function () {\r\n    init(function () {\r\n        // init done\r\n        // load local\r\n        loadStaffList();\r\n        let $schedule = $(\"div#schedule\");\r\n        if (staticLocalChart !== null && staticLocalChart !== \"\") {\r\n            $schedule.html(staticLocalChart);\r\n            loadCheck();\r\n        }\r\n        $schedule.children('h3').text(new Date().toLocaleDateString().replace(/\\//g, '-'));\r\n        // init popovers\r\n        initPopovers();\r\n        // bind events\r\n        bindEvents();\r\n        // bind draw line\r\n        bindDrawLine();\r\n\r\n        // show modal authorize\r\n        if (typeof sessionStorage.authorized === \"undefined\") {\r\n            $(\"div#modal_authorize\").modal('show');\r\n        }\r\n    });\r\n\r\n    // init switch\r\n    $(\"input#edit_lock\").bootstrapSwitch({\r\n        'state': false,\r\n        'size': 'small',\r\n        'onText': '\\u2714',\r\n        'offText': '\\u2718',\r\n        'onSwitchChange': function () {\r\n            let state = $(\"input#edit_lock\").bootstrapSwitch('state');\r\n            let $chart = $('div#schedule');\r\n            if (state === true) {\r\n                $chart.find('table thead th').children('span').show();\r\n                $chart.children('div').show();\r\n            } else if (state === false) {\r\n                $chart.find('table thead th').children('span').hide();\r\n                $chart.children('div').hide();\r\n            }\r\n        }\r\n    });\r\n\r\n    // make draggable\r\n    makeDraggable($('div#staff_list'), $(\"button#staff_list_move_handle\"));\r\n});\r\n\r\n/**\r\n * load local config file\r\n * @param callback called on completion\r\n */\r\nfunction init(callback) {\r\n    let count = 0;\r\n    $.getJSON(\"data/luke_config.json\", function (data) {\r\n        if (data == null) {\r\n            return;\r\n        }\r\n        staticLocalJson = data;\r\n    }).done(function () {\r\n        if (++count === 2) callback();\r\n    });\r\n    $.get(\"data/chart.txt\", function (data) {\r\n        if (data == null) {\r\n            return;\r\n        }\r\n        staticLocalChart = data;\r\n    }).done(function () {\r\n        if (++count === 2) callback();\r\n    });\r\n}\r\n\r\n/**\r\n * init popovers\r\n */\r\nfunction initPopovers() {\r\n    $(\"button#staff_list_add_btn\").popover({\r\n        content: \"一次只能新增一个空白团员\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', addStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"button#staff_attr_save_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', saveStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"button#staff_attr_del_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', deleteStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n}\r\n\r\n/**\r\n * bind events\r\n */\r\nfunction bindEvents() {\r\n    // click on a staff button to read its attributes\r\n    $(\"div#staff_list\").children(\"div\").on('click', 'button', function (e) {\r\n        readStaffAttributes(e, $(this).index());\r\n    });\r\n\r\n    // save data on leaving\r\n    window.onbeforeunload = saveToLocal;\r\n\r\n    // filter staff\r\n    $(\"div#staff_list_filter\").find(\"input[name='options']\").on('change', filterStaff);\r\n\r\n    // search\r\n    $(\"input#staff_search\").on('change keydown', function (e) {\r\n        if (e.type === \"keydown\" && e.keyCode !== 13) return;\r\n        let $list = $(\"div#staff_list\").children(\"div\").children(\"button\");\r\n        let key = $(this).val();\r\n        if (key === \"\") {\r\n            $list.show();\r\n        } else {\r\n            $list.hide().filter(\":contains(\" + key + \")\").show();\r\n        }\r\n    });\r\n    $(\"input#schedule_search\").on('change keydown', function (e) {\r\n        if (e.type === \"keydown\" && e.keyCode !== 13) return;\r\n        let $cell = $(\"div#schedule\").find(\"tbody tr td\");\r\n        let key = $(this).val();\r\n        if (key === \"\") {\r\n            $cell.removeClass(\"schedule-search-result\");\r\n        } else {\r\n            $cell.removeClass(\"schedule-search-result\").filter(\":contains(\" + key + \")\").addClass(\"schedule-search-result\");\r\n        }\r\n    });\r\n\r\n    // modal\r\n    $('div#modal_add_name').on('show.bs.modal', function () {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('div#modal_add_name').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    }).on(\"shown.bs.modal\", function () {\r\n        $(\"input#modal_add_name_input\").focus();\r\n    });\r\n    $(\"input#modal_add_name_input\").on('keydown', function (e) {\r\n        if (e.keyCode === 13) {\r\n            addName();\r\n            $(this).val('');\r\n        }\r\n    });\r\n    $('div#modal_authorize').on('show.bs.modal', function () {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('div#modal_authorize').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    }).on(\"shown.bs.modal\", function () {\r\n        $(\"input#modal_authorize_input\").focus();\r\n    });\r\n    $(\"input#modal_authorize_input\").on('keydown', function (e) {\r\n        if (e.keyCode === 13) {\r\n            checkAuth();\r\n        }\r\n    });\r\n\r\n    // row/chart add&delete\r\n    const alphabet = ['A', 'B', 'C', 'D', 'E', 'F', 'G'];\r\n    const time = ['20:00', '20:30', '21:00', '21:30', '22:00', '22:30', '23:00', '23:30', '0:00', '0:30'];\r\n    $(\"div#schedule\").on('click', \"[name='row-add']\", function () {\r\n        let $table = $(this).parentsUntil('div#schedule').filter('table');\r\n        let count = $table.find('tbody tr').length;\r\n        if (count >= 7) return;// max support 7 rows per chart\r\n        $table.append('<tr><th scope=\"row\">' + alphabet[count] + '队</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>');\r\n        resizeSVG();\r\n    }).on('click', \"[name='row-delete']\", function () {\r\n        let $tr = $(this).parentsUntil('div#schedule').filter('table').find('tbody tr');\r\n        let count = $tr.length;\r\n        if (count <= 1) return;// min support 1 row per chart\r\n        $tr.eq(count - 1).remove();\r\n        resizeSVG();\r\n    }).on('click', \"[name='chart-add']\", function () {\r\n        let count = $(\"div#schedule\").children(\"table\").length;\r\n        if (count >= 10) return;// max support 10 charts\r\n        $(\"<table class=\\\"table table-bordered text-center\\\">\\n\" +\r\n            \"<thead>\\n\" +\r\n            \"<tr>\\n\" +\r\n            \"    <th class=\\\"bg-success\\\">\" + time[count] + \"\\n\" +\r\n            \"        <span class=\\\"pull-right\\\">\\n\" +\r\n            \"            <button title=\\\"在该时间段末尾增加一个团\\\"  type=\\\"button\\\" class=\\\"btn btn-info btn-xxs\\\" name=\\\"row-add\\\">\\n\" +\r\n            \"                <span class=\\\"glyphicon glyphicon-plus\\\"></span>\\n\" +\r\n            \"            </button>\\n\" +\r\n            \"            <button title=\\\"将该时间段末尾的团删去\\\" type=\\\"button\\\" class=\\\"btn btn-info btn-xxs\\\" name=\\\"row-delete\\\">\\n\" +\r\n            \"                <span class=\\\"glyphicon glyphicon-minus\\\"></span>\\n\" +\r\n            \"            </button>\\n\" +\r\n            \"        </span>\\n\" +\r\n            \"    </th>\\n\" +\r\n            \"    <th class=\\\"text-center\\\" colspan=\\\"4\\\">光</th>\\n\" +\r\n            \"    <th class=\\\"text-center\\\" colspan=\\\"4\\\">暗</th>\\n\" +\r\n            \"</tr>\\n\" +\r\n            \"</thead>\\n\" +\r\n            \"<tbody>\\n\" +\r\n            \"<tr>\\n\" +\r\n            \"    <th scope=\\\"row\\\">A队</th>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"</tr>\\n\" +\r\n            \"</tbody>\\n\" +\r\n            \"</table>\").insertBefore(\"div#schedule>div\");\r\n        resizeSVG();\r\n    }).on('click', \"[name='chart-delete']\", function () {\r\n        let $table = $(\"div#schedule\").children(\"table\");\r\n        let count = $table.length;\r\n        if (count <= 1) return;// min support 1 chart\r\n        $table.eq(count - 1).remove();\r\n        resizeSVG();\r\n    });\r\n\r\n    // export\r\n    $(\"button#export_btn\").on(\"click\", function () {\r\n        console.log(\"export\");\r\n        html2canvas($(\"div#schedule\").get(0)).then(function (canvas) {\r\n            $(\"img#screen_shot_img\").attr(\"src\", canvas.toDataURL());\r\n        });\r\n        $(\"div#modal_img\").modal(\"show\");\r\n    });\r\n}\r\n\r\n/**\r\n * experience. have none access to save changes\r\n */\r\nfunction experience() {\r\n    sessionStorage.authorized = \"none\";\r\n    $(\"div#modal_authorize\").modal('hide');\r\n}\r\n\r\n/**\r\n * check auth. `premium`: have all access. `fundamental`: access to save staff.\r\n */\r\nfunction checkAuth() {\r\n    let code = $(\"input#modal_authorize_input\").val().trim();\r\n    let $enter = $(\"button#btn_auth_enter\");\r\n    // clear help block\r\n    let $help = $(\"span#helpBlock\");\r\n    let result = md5(code);\r\n    // check\r\n    if (result === staticLocalJson.auth_pre) {\r\n        $help.text('团长授权：可保存所有改动');\r\n        $enter.prop(\"disabled\", false);\r\n    } else if (result === staticLocalJson.auth_fun) {\r\n        $help.text('团员授权：只可保存团员区改动');\r\n        $enter.prop(\"disabled\", false);\r\n    } else {\r\n        $help.text('授权码不对，无保存权限，请联系小明');\r\n        $enter.prop(\"disabled\", true);\r\n    }\r\n}\r\n\r\n/**\r\n * authorize. set session authorization and enter.\r\n */\r\nfunction authorize() {\r\n    let code = $(\"input#modal_authorize_input\").val().trim();\r\n    let result = md5(code);\r\n    // check\r\n    if (result === staticLocalJson.auth_pre) {\r\n        sessionStorage.authorized = \"premium\";\r\n    } else if (result === staticLocalJson.auth_fun) {\r\n        sessionStorage.authorized = \"fundamental\";\r\n    } else {\r\n        sessionStorage.authorized = \"none\";\r\n        $(\"span#helpBlock\").text('授权码不对，无保存权限，请联系小明');\r\n        return;\r\n    }\r\n    $(\"div#modal_authorize\").modal('hide');\r\n}\r\n\r\n/**\r\n * when a staff button is clicked, load his attributes\r\n * @param e event object\r\n * @param i index of that button\r\n */\r\nfunction readStaffAttributes(e, i) {\r\n    let id = parseInt(e.target.getAttribute(\"data-id\"));\r\n    $(\"div#staff_attr_panel\").attr(\"data-id\", id);\r\n    // new staff\r\n    if (id === staticLocalJson.staff_auto_increment) {\r\n        // reset attributes group\r\n        $(\"select#staff_attr_name_select\").val(-1);\r\n        $(\"input#staff_attr_career_input\").val(\"\");\r\n        $(\"select#staff_attr_type_select\").val(0);\r\n        $(\"input#staff_attr_absence_check\").prop(\"checked\", false);\r\n        $(\"div#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        $(\"div#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        $(\"div#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n        return;\r\n    }\r\n    // read local attributes\r\n    let list = staticLocalJson.staff_list;\r\n    if (list[i].id === id) {\r\n        // main attributes\r\n        let index_namelist = staticNameList.indexOf(list[i].name);\r\n        $(\"select#staff_attr_name_select\").val(index_namelist);\r\n        $(\"input#staff_attr_career_input\").val(list[i].career);\r\n        $(\"select#staff_attr_type_select\").val(list[i].type);\r\n        $(\"input#staff_attr_absence_check\").prop(\"checked\", list[i].absence);\r\n        // other attributes\r\n        $(\"div#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(list[i].attack - 1).addClass(\"active\");\r\n        $(\"div#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(list[i].control - 1).addClass(\"active\");\r\n        $(\"div#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(list[i].element - 1).addClass(\"active\");\r\n    } else {\r\n        console.log(i + ' ' + list[i].id + ' ' + id);\r\n        // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        alert(\"错误代码600，请告知小明\");\r\n    }\r\n}\r\n\r\n/**\r\n * load staff list on the left from local json\r\n */\r\nfunction loadStaffList() {\r\n    let $staff_list = $(\"div#staff_list\").children(\"div\");\r\n    $staff_list.empty();\r\n    $.each(staticLocalJson.staff_list, function (index, item) {\r\n        // load name list\r\n        if (staticNameList.indexOf(item.name) === -1) {\r\n            staticNameList.push(item.name);\r\n        }\r\n\r\n        // load staff\r\n        let elementNode = document.createElement(\"button\");\r\n        elementNode.setAttribute(\"type\", \"button\");\r\n        elementNode.setAttribute(\"data-id\", item.id);\r\n        elementNode.className = \"btn btn-default\";\r\n        elementNode.innerHTML = item.name + item.career;\r\n        if (item.type === 1) {\r\n            elementNode.className += \" career-c\";\r\n        } else if (item.type === 2) {\r\n            elementNode.className += \" career-assist\";\r\n        } else if (item.type === 3) {\r\n            elementNode.className += \" career-priest\";\r\n        }\r\n        if (item.absence) {\r\n            elementNode.className += \" career-absence\";\r\n        }\r\n        $staff_list.append(elementNode);\r\n    });\r\n    resizeSVG();\r\n    loadNameList();\r\n}\r\n\r\n/**\r\n * create name select widget from static list\r\n */\r\nfunction loadNameList() {\r\n    let $name_select = $(\"select#staff_attr_name_select\");\r\n    $name_select.empty();\r\n    $name_select.append(new Option(\"称谓\", \"-1\"));\r\n    $.each(staticNameList, function (index, item) {\r\n        $name_select.append(new Option(item, index));\r\n    });\r\n}\r\n\r\n/**\r\n * check '.in-schedule' from schedule and check '.absence' from staff list\r\n */\r\nfunction loadCheck() {\r\n    let $cell = $(\"div#schedule\").find(\"tbody tr td\");\r\n    let $staff = $(\"div#staff_list\").children(\"div\").find(\"button\");\r\n    $cell.each(function () {\r\n        let text = $(this).text();\r\n        if (text === null || text === \"\" || text === \"空\") return;\r\n        let $target = $staff.filter(\":contains(\" + text + \")\");\r\n        $target.each(function () {\r\n            if ($(this).text() === text) {\r\n                if ($(this).hasClass(\"career-absence\")) {\r\n                    $cell.removeAttr(\"data-name\").text(\"\");\r\n                } else if (!$(this).hasClass(\"in-schedule\")) {\r\n                    $(this).addClass(\"in-schedule\");\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * filter staff list according to the checkboxes\r\n */\r\nfunction filterStaff() {\r\n    let filterConditions = [\".career-c\", \".career-assist\", \".career-priest\", \".in-schedule\", \".career-absence\"];\r\n\r\n    let $filterInputs = $(\"div#staff_list_filter\").find(\"input\");\r\n    $filterInputs.each(function () {\r\n        let index = parseInt($(this).attr(\"data-filter\"));\r\n        if ($(this).parent().hasClass('active')) {\r\n            $(\"div#staff_list\").find(filterConditions[index - 1]).show();\r\n        } else {\r\n            // hide\r\n            $(\"div#staff_list\").find(filterConditions[index - 1]).hide();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * add a blank staff button\r\n */\r\nfunction addStaff() {\r\n    let $btn_list = $(\"div#staff_list\").children('div');\r\n    let increment = staticLocalJson.staff_auto_increment;\r\n    let exist = $btn_list.children(\"button\").is(\"[data-id=\" + increment + \"]\");\r\n    if (exist) {\r\n        $(\"button#staff_list_add_btn\").popover('show');\r\n        return;\r\n    }\r\n    let elementNode = document.createElement(\"button\");\r\n    elementNode.setAttribute(\"type\", \"button\");\r\n    elementNode.setAttribute(\"data-id\", increment.toString());\r\n    elementNode.className = \"btn btn-default\";\r\n    elementNode.innerHTML = \"新增人员\";\r\n    $btn_list.append(elementNode);\r\n}\r\n\r\n/**\r\n * add a new staff name to static list\r\n * and reload the name select widget\r\n */\r\nfunction addName() {\r\n    let $input = $(\"input#modal_add_name_input\");\r\n    let name = $input.val().trim();\r\n    let $modal = $(\"div#modal_add_name\");\r\n    if (name === null || name === '') {\r\n        $modal.modal('hide');\r\n        return;\r\n    }\r\n    staticNameList.push(name);\r\n    loadNameList();\r\n    $(\"select#staff_attr_name_select\").val(staticNameList.length - 1);\r\n    $modal.modal('hide');\r\n    $input.val('');\r\n}\r\n\r\n/**\r\n * save the attribute changes to local\r\n * and refresh the corresponding button\r\n */\r\nfunction saveStaff() {\r\n    let id = parseInt($(\"div#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"div#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $('button#staff_attr_save_btn').popover('show');\r\n        return;\r\n    }\r\n    // read staff\r\n    let staff = {\r\n        \"id\": id,\r\n        \"name\": staticNameList[parseInt($(\"select#staff_attr_name_select\").val())],\r\n        \"career\": $(\"input#staff_attr_career_input\").val().trim(),\r\n        \"type\": parseInt($(\"select#staff_attr_type_select\").val()),\r\n        \"absence\": $(\"input#staff_attr_absence_check\").prop('checked'),\r\n        \"attack\": $(\"div#staff_attr_other_attack\").find('label.active').index() + 1,\r\n        \"control\": $(\"div#staff_attr_other_control\").find('label.active').index() + 1,\r\n        \"element\": $(\"div#staff_attr_other_element\").find('label.active').index() + 1\r\n    };\r\n    if (staff.id === staticLocalJson.staff_auto_increment) { // new staff\r\n        // save to cache\r\n        staticLocalJson.staff_list.push(staff);\r\n        staticLocalJson.staff_auto_increment++;\r\n    } else { // old staff\r\n        let index = $staff_btn.index();\r\n        if (staticLocalJson.staff_list[index].id === staff.id) {\r\n            staticLocalJson.staff_list[index] = staff;\r\n        } else {\r\n            // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n            alert(\"错误代码601，请告知小明\");\r\n        }\r\n    }\r\n    // refresh staff button\r\n    $staff_btn.text(staff.name + staff.career);\r\n    if (staff.type === 1) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-c\");\r\n    } else if (staff.type === 2) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-assist\");\r\n    } else if (staff.type === 3) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default career-priest\");\r\n    } else if (staff.type === 0) {\r\n        $staff_btn.attr(\"class\", \"btn btn-default\");\r\n    }\r\n    if (staff.absence) {\r\n        $staff_btn.addClass(\"career-absence\");\r\n    }\r\n}\r\n\r\n/**\r\n * delete the corresponding staff button both from page and static json\r\n */\r\nfunction deleteStaff() {\r\n    let id = parseInt($(\"div#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"div#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $(\"button#staff_attr_del_btn\").popover('show');\r\n        return;\r\n    }\r\n\r\n    let index = $staff_btn.index();\r\n    // delete btn\r\n    $staff_btn.remove();\r\n    if (staticLocalJson.staff_auto_increment === id) {// newly added\r\n        return;\r\n    }\r\n    // delete from static json\r\n    if (staticLocalJson.staff_list[index].id === id) {\r\n        staticLocalJson.staff_list.splice(index, 1);\r\n    } else {\r\n        // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        alert(\"错误代码602，请告知小明\");\r\n    }\r\n}\r\n\r\n/**\r\n * save all changes to local .json file\r\n */\r\nfunction saveToLocal() {\r\n    if (sessionStorage.authorized === null || sessionStorage.authorized === \"none\") {\r\n        return;\r\n    }\r\n    // premium -----\r\n    // save schedule to local\r\n    if (sessionStorage.authorized === \"premium\") {\r\n        $.ajax({\r\n            method: 'post',\r\n            url: 'php/saveChart.php',\r\n            async: false,// important\r\n            data: {\r\n                'toStore': $(\"div#schedule\").html()\r\n            }\r\n        });\r\n    }\r\n    // fundamental -----\r\n    // save json\r\n    if (sessionStorage.authorized === \"fundamental\" || sessionStorage.authorized === \"premium\") {\r\n        let dataToStore = JSON.stringify(staticLocalJson, null, 4);\r\n        $.ajax({\r\n            method: 'post',\r\n            url: 'php/saveJSON.php',\r\n            async: false,// important\r\n            data: {\r\n                'toStore': dataToStore\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * make the corresponding dom draggable\r\n * @param $object jquery selector, object to be dragged\r\n * @param $handle the move handle\r\n */\r\nfunction makeDraggable($object, $handle) {\r\n    if (!$object instanceof jQuery) {\r\n        return;\r\n    }\r\n    let isMove = false;\r\n    let X, Y;\r\n    $handle.on('mousedown', function (e) {\r\n        isMove = true;\r\n        X = e.pageX - parseInt($object.css(\"left\"));\r\n        Y = e.pageY - parseInt($object.css(\"top\"));\r\n    });\r\n    $(document).on('mousemove', function (e) {\r\n        if (isMove) {\r\n            let left = e.pageX - X;\r\n            let top = e.pageY - Y;\r\n            $object.css({left: left, top: top});\r\n        }\r\n    }).on('mouseup', function () {\r\n        isMove = false;\r\n    });\r\n}\r\n\r\n/**\r\n * when nodes be added to or removed from DOM and the height has changed,\r\n * the svg needs to resize\r\n */\r\nfunction resizeSVG() {\r\n    $('.line').css({width: document.body.scrollWidth, height: document.body.scrollHeight});\r\n}\r\n\r\n/**\r\n * when drag event happening on a staff button, draw a line from start to end\r\n * if the dragging ends within the schedule chart, fill the cell with the staff\r\n *\r\n * add support for exchanging staffs in the schedule\r\n */\r\nfunction bindDrawLine() {\r\n    // reinitialize svg width & height\r\n    $('.line').css({width: document.body.scrollWidth, height: document.body.scrollHeight});\r\n    // bind\r\n    let isDraw = false, isDrop = false, isExchange = false;\r\n    let $svg = $('svg');\r\n    // button\r\n    let staffId;\r\n    let index;\r\n    // table\r\n    let $td;\r\n    // pick staff\r\n    let $buttons = $(\"div#staff_list\").children('div');\r\n    $buttons.on('mousedown', 'button', function (e) {\r\n        // unlock drawing\r\n        isDraw = true;\r\n        // read staff id\r\n        staffId = parseInt($(e.target).attr('data-id'));\r\n        index = parseInt($(e.target).index());\r\n        // draw a line\r\n        $svg.children('line').attr({x1: e.pageX, y1: e.pageY, x2: e.pageX, y2: e.pageY});\r\n    });\r\n    let $schedule = $(\"div#schedule\");\r\n    $schedule.on(\"mousedown\", \"table tr td\", function (e) {\r\n        // unlock drawing\r\n        isDraw = true;\r\n        // exchange flag\r\n        isExchange = true;\r\n        // read staff\r\n        $td = $(e.target);\r\n        // draw a line\r\n        $svg.children('line').attr({x1: e.pageX, y1: e.pageY, x2: e.pageX, y2: e.pageY});\r\n    });\r\n    // draw line\r\n    $(document).on('mousemove', function (e) {\r\n        if (isDraw) {\r\n            if (!$svg.is(':visible')) {\r\n                $svg.show();\r\n            }\r\n            // draw a line\r\n            $svg.children('line').attr({x2: e.pageX, y2: e.pageY});\r\n        }\r\n    }).on('mouseup', function () {\r\n        if (isDraw) {\r\n            isDraw = false;\r\n            $svg.hide();\r\n\r\n            // allow drop\r\n            isDrop = true;\r\n            setTimeout(function () {\r\n                isDrop = false;\r\n            }, 50);\r\n        }\r\n    });\r\n    // drop staff\r\n    $schedule.on('mouseover', 'table tr td', function () {\r\n        if (isDrop) {\r\n            if (isExchange) {\r\n                // exchange\r\n                let staff_name = $td.attr(\"data-name\");\r\n                let staff_text = $td.text();\r\n                let $target = $(this);\r\n                let this_name = $target.attr(\"data-name\");\r\n                let this_text = $target.text();\r\n                $td.attr(\"data-name\", !this_name ? \"\" : this_name);\r\n                $td.text(!this_text ? \"\" : this_text);\r\n                $target.attr(\"data-name\", !staff_name ? \"\" : staff_name);\r\n                $target.text(!staff_text ? \"\" : staff_text);\r\n                // reset\r\n                isExchange = false;\r\n                // mark duplication\r\n                markDuplicate(false, $td);\r\n                markDuplicate(false, $target);\r\n                return;\r\n            }\r\n            let staff = staticLocalJson.staff_list[index];\r\n            if (staff.id === staffId) {\r\n                let staff_out_text = $(this).text();\r\n                let $staff_list = $(\"div#staff_list\");\r\n                // remove duplication\r\n                if (staff.name !== \"空\") {\r\n                    let text = staff.name + staff.career;\r\n                    let $contain = $(\"div#schedule\").find(\"tbody tr td\").filter(\":contains(\" + text + \")\");\r\n                    $contain.each(function () {\r\n                        if ($(this).text() === text) {\r\n                            $(this).removeAttr(\"data-name\").text(\"\");\r\n                            markDuplicate(false, $(this));\r\n                        }\r\n                    })\r\n                }\r\n                // fill in the cell\r\n                $(this).attr('data-name', staff.name).text(staff.name + staff.career);\r\n                // set staff to '.in-schedule'\r\n                let $staff_in = $staff_list.find('button[data-id=' + staffId + ']');\r\n                if (!$staff_in.hasClass('in-schedule') && staff.name !== \"空\") {\r\n                    $staff_in.addClass('in-schedule');\r\n                    // hide\r\n                    if ($(\"div#staff_list_filter\").find('input[data-filter=4]').prop(\"checked\") === false) {\r\n                        $staff_in.hide();\r\n                    }\r\n                }\r\n                // consider REPLACE\r\n                if (staff_out_text !== \"\" && staff_out_text !== \"空\") {\r\n                    let $contain = $staff_list.find(\"button:contains(\" + staff_out_text + \")\");\r\n                    $contain.each(function () {\r\n                        if ($(this).text() === staff_out_text) {\r\n                            $(this).removeClass(\"in-schedule\").show();\r\n                        }\r\n                    })\r\n                }\r\n            } else {\r\n                // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n                alert(\"错误代码603，请告知小明\");\r\n            }\r\n            isDrop = false;\r\n            // check duplication partly\r\n            markDuplicate(false, $(this));\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * check duplication in schedule\r\n * @param scale boolean. true:wholly, false:partly. if false, a root object is needed\r\n */\r\nfunction markDuplicate(scale) {\r\n    if (scale) {\r\n\r\n    } else {\r\n        if (typeof arguments[1] === \"object\") {\r\n            // recover\r\n            let $obj = arguments[1];\r\n            let $td = $obj.parentsUntil('table').find('td');\r\n            $td.css('color', '');\r\n            // check\r\n            let map = {};\r\n            $.each($td, function () {\r\n                let key = $(this).attr('data-name');\r\n                if (key !== \"空\" && !!key) {\r\n                    if (typeof map[key] === \"undefined\") {\r\n                        map[key] = 1;// first met\r\n                    } else if (map[key] === 1) {\r\n                        $td.filter('[data-name=' + key + ']').css('color', 'red');\r\n                        map[key] = 2;// handled\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            // Error 70x:参数传递错误\r\n            alert(\"错误代码701，请告知小明\");\r\n        }\r\n    }\r\n}\r\n\r\n"]}