{"version":3,"sources":["../../js/luke.js"],"names":["staticLocalStaffList","firstBattleTime","Date","setHours","battleInterval","staticNameList","scheduleHistoryHtml","$","document","ready","init","initPopovers","bindEvents","bindDrawLine","sessionStorage","authorized","test","navigator","userAgent","modal","bootstrapSwitch","state","$chart","find","children","show","hide","makeDraggable","callback","text","toLocaleDateString","replace","requestSetting","requestStaff","requestSchedule","requestScheduleList","post","rule","data","status","json","JSON","parse","code","toast","showHideTransition","icon","heading","msg","hideAfter","staff_real","loadStaffList","staff_in_order","id","constructChart","datatime","content","loadCheck","list","contentHtml","forEach","item","substr","time","arrayParam","chartArray","a","Array","$schedule","html","append","tableHtml","periodArray","indexPeriod","add","Format","teamArray","indexTeam","String","fromCharCode","staffId","parseInt","staff","name","career","alert","popover","placement","trigger","on","addStaff","saveStaff","deleteStaff","e","readStaffAttributes","filterStaff","select","type","keyCode","$list","key","val","trim","filter","$cell","removeClass","addClass","css","modalHeight","window","height","focus","addName","checkAuth","$table","parentsUntil","count","length","resizeSVG","$tr","eq","remove","insertBefore","html2canvas","get","then","canvas","attr","toDataURL","stopPropagation","experience","$enter","$help","prop","authorize","auth","target","getAttribute","resetStaffAttributesPanel","index_namelist","indexOf","absence","attack","control","element","staffList","$staff_list","empty","each","index","push","elementNode","createElement","setAttribute","className","innerHTML","loadNameList","$name_select","Option","$staff","$target","$current","hasClass","removeAttr","filterConditions","$filterInputs","parent","$btn_list","increment","exist","is","toString","$input","$modal","batchLeave","idList","$checkList","method","click","$staff_btn","Math","round","random","textDeleted","splice","undoDeleteStaff","idDeleted","saveSchedule","extractSchedule","scheduleArray","staffArray","$td","deleted","$object","$handle","jQuery","isMove","X","Y","pageX","pageY","left","top","width","body","scrollWidth","scrollHeight","isDraw","isDrop","isExchange","$svg","$buttons","x1","y1","x2","y2","setTimeout","staff_id","staff_name","staff_text","this_id","this_name","this_text","markDuplicate","id_replaced","$contain","$staff_in","scale","arguments","$obj","map"],"mappings":"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","file":"luke.js","sourcesContent":["'use strict';\r\nlet staticLocalStaffList = null;\r\nlet firstBattleTime = new Date();\r\nfirstBattleTime.setHours(20, 0, 0);\r\nlet battleInterval = 30;\r\nlet staticNameList = [];\r\nlet scheduleHistoryHtml = \"\";\r\n\r\n$(document).ready(function () {\r\n    init(function () {\r\n        // init popovers\r\n        initPopovers();\r\n        // bind events\r\n        bindEvents();\r\n        // bind draw line\r\n        bindDrawLine();\r\n\r\n        // show modal authorize\r\n        if (typeof sessionStorage.authorized === \"undefined\" && !/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {\r\n            $(\"div#modal_authorize\").modal('show');\r\n        }\r\n    });\r\n\r\n    // init switch\r\n    if (!/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {\r\n        $(\"input#edit_lock\").bootstrapSwitch({\r\n            'state': false,\r\n            'size': 'small',\r\n            'labelText': '表',\r\n            'onText': '\\u2714',\r\n            'offText': '\\u2718',\r\n            'onSwitchChange': function () {\r\n                let state = $(\"input#edit_lock\").bootstrapSwitch('state');\r\n                let $chart = $('div#schedule');\r\n                if (state === true) {\r\n                    $chart.find('table thead th').children('span').show();\r\n                    $chart.children('div').show();\r\n                } else if (state === false) {\r\n                    $chart.find('table thead th').children('span').hide();\r\n                    $chart.children('div').hide();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // make draggable\r\n    makeDraggable($('div#staff_list'), $(\"button#staff_list_move_handle\"));\r\n});\r\n\r\n/**\r\n * request data from server\r\n * @param callback called on completion\r\n */\r\nfunction init(callback) {\r\n    $(\"div#schedule\").children('h3').text(new Date().toLocaleDateString().replace(/\\//g, '-'));\r\n    // load from server\r\n    requestSetting();\r\n    requestStaff(function () {\r\n        requestSchedule(null, callback);\r\n    });\r\n    requestScheduleList();\r\n}\r\n\r\n/**\r\n * request system setting - interval\r\n */\r\nfunction requestSetting() {\r\n    $.post(\"php/SysSetting.php\", {\r\n        rule: 'luke_interval'\r\n    }, function (data, status) {\r\n        if (status === \"success\") {\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // local setting\r\n                battleInterval = json.data || 30;\r\n                // toast when not on load\r\n                $.toast({\r\n                    text: \"已获取最新设置\",\r\n                    showHideTransition: 'fade',\r\n                    icon: \"info\"\r\n                });\r\n            } else {\r\n                // alert error\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n        } else {\r\n            // alert fail\r\n            $.toast({\r\n                heading: \"获取设置失败\",\r\n                text: \"请稍后尝试刷新页面\",\r\n                showHideTransition: 'fade',\r\n                icon: \"error\",\r\n                hideAfter: false\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * request staff list from server\r\n * @param callback called on completion\r\n */\r\nfunction requestStaff(callback) {\r\n    $.post(\"php/StaffList.php\", function (data, status) {\r\n        if (status === \"success\") {\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // local list\r\n                staticLocalStaffList = json.data.staff_real;\r\n                // load staff\r\n                loadStaffList(json.data.staff_in_order);\r\n                // toast when not on load\r\n                $.toast({\r\n                    text: \"已获取最新团员列表\",\r\n                    showHideTransition: 'fade',\r\n                    icon: \"info\"\r\n                });\r\n            } else {\r\n                // alert error\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n            // callback\r\n            if (callback !== null && typeof callback === \"function\") {\r\n                callback();\r\n            }\r\n        } else {\r\n            // alert fail\r\n            $.toast({\r\n                heading: \"获取团员列表失败\",\r\n                text: \"请稍后尝试刷新页面\",\r\n                showHideTransition: 'fade',\r\n                icon: \"error\",\r\n                hideAfter: false\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * if id is not null, request corresponding schedule; else request the newest\r\n * @param id id of schedule\r\n * @param callback called on completion\r\n */\r\nfunction requestSchedule(id, callback) {\r\n    $.post(\"php/ScheduleSL.php\", {\r\n        \"method\": \"load\",\r\n        \"id\": id\r\n    }, function (data, status) {\r\n        if (status === \"success\") {\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // construct chart\r\n                if (json.data) {\r\n                    constructChart(json.data.datatime, json.data.content);\r\n                    // load check\r\n                    loadCheck();\r\n                }\r\n                // toast when not on load\r\n                if (callback == null) {\r\n                    $.toast({\r\n                        text: \"排表载入完成\",\r\n                        showHideTransition: 'fade',\r\n                        icon: \"info\"\r\n                    });\r\n                }\r\n            } else {\r\n                // alert error\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n            // callback\r\n            if (callback !== null && typeof callback === \"function\") {\r\n                callback();\r\n            }\r\n        } else {\r\n            // alert fail\r\n            $.toast({\r\n                heading: \"获取排表失败\",\r\n                text: \"请稍后尝试刷新页面\",\r\n                showHideTransition: 'fade',\r\n                icon: \"error\",\r\n                hideAfter: false\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * request schedule list from server, and form it into html string\r\n * @returns {string} html string\r\n */\r\nfunction requestScheduleList() {\r\n    $.post(\"php/ScheduleList.php\", function (data, status) {\r\n        if (status === \"success\") {\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // construct chart\r\n                if (json.data) {\r\n                    // construct list\r\n                    let list = json.data;\r\n                    let contentHtml = \"<ul>\";\r\n                    list.forEach(function (item) {\r\n                        contentHtml += \"<li><a class='schedule-history' data-id=\\\"\" + item.id + \"\\\">\" + item.datatime.substr(0, 10) + \"</a></li>\";\r\n                    });\r\n                    contentHtml += \"</ul>\";\r\n                    scheduleHistoryHtml = contentHtml;\r\n                } else {\r\n                    // no data\r\n                    scheduleHistoryHtml = \"暂无排表历史\";\r\n                }\r\n            } else {\r\n                scheduleHistoryHtml = \"暂无排表历史\";\r\n                // alert error\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n        } else {\r\n            scheduleHistoryHtml = \"暂无排表历史\";\r\n            // alert fail\r\n            $.toast({\r\n                heading: \"获取排表历史失败\",\r\n                text: \"请稍后尝试刷新页面\",\r\n                showHideTransition: 'fade',\r\n                icon: \"error\",\r\n                hideAfter: false\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * construct chart\r\n * @param time chart data time\r\n * @param arrayParam array of the whole chart\r\n * @returns {boolean} false if chartArray is in wrong format\r\n */\r\nfunction constructChart(time, arrayParam) {\r\n    let chartArray = JSON.parse(arrayParam.replace(/[\\u4e00-\\u9fa5\\w]+/g, function (a) {\r\n        return '\"' + a + '\"';\r\n    }));\r\n    if (chartArray instanceof Array) {\r\n        // clear schedule\r\n        let $schedule = $(\"div#schedule\");\r\n        $schedule.html(\"\");\r\n        // add time and search box\r\n        $schedule.append('<h3 class=\"text-center\">' + time.substr(0, 10) + '</h3>');\r\n        $schedule.append('<input title=\"在排表区查找对象\" type=\"search\" class=\"pull-right\" id=\"schedule_search\" autocomplete=\"off\">');\r\n        let tableHtml = '';\r\n        // chartArray is the whole schedule\r\n        chartArray.forEach(function (periodArray, indexPeriod) {\r\n            if (periodArray instanceof Array) {\r\n                // periodArray是一个时间段，对应table\r\n                tableHtml += '<table class=\"table table-bordered text-center\"><thead><tr>\\n' +\r\n                    ' <th class=\"bg-success\">' + firstBattleTime.add(\"m\", battleInterval * indexPeriod).Format(\"hh:mm\") + '\\n' +\r\n                    '     <span class=\"pull-right\" style=\"display: none;\">\\n' +\r\n                    '         <button title=\"在该时间段末尾增加一个团\" type=\"button\" class=\"btn btn-info btn-xxs\" name=\"row-add\">\\n' +\r\n                    '             <span class=\"glyphicon glyphicon-plus\"></span>\\n' +\r\n                    '         </button>\\n' +\r\n                    '         <button title=\"将该时间段末尾的团删去\" type=\"button\" class=\"btn btn-info btn-xxs\" name=\"row-delete\">\\n' +\r\n                    '             <span class=\"glyphicon glyphicon-minus\"></span>\\n' +\r\n                    '         </button>\\n' +\r\n                    '     </span>\\n' +\r\n                    ' </th>\\n' +\r\n                    ' <th class=\"text-center\" colspan=\"4\">光</th>\\n' +\r\n                    ' <th class=\"text-center\" colspan=\"4\">暗</th>\\n' +\r\n                    ' </tr></thead><tbody>';\r\n                periodArray.forEach(function (teamArray, indexTeam) {\r\n                    if (teamArray instanceof Array) {\r\n                        // teamArray是一个队，对应tr\r\n                        tableHtml += '<tr><th scope=\"row\">' + String.fromCharCode(65 + indexTeam) + '队' + '</th>';\r\n                        teamArray.forEach(function (staffId) {\r\n                            staffId = parseInt(staffId);\r\n                            if (staffId === 0) {\r\n                                // add null td\r\n                                tableHtml += '<td></td>';\r\n                            } else {\r\n                                // staff是一个团员id，对应td\r\n                                let staff = staticLocalStaffList[staffId - 1];\r\n                                if (parseInt(staff.id) === staffId) {\r\n                                    tableHtml += '<td data-id=\"' + staff.id + '\" data-name=\"' + staff.name + '\">' + staff.name + staff.career + '</td>';\r\n                                } else {\r\n                                    // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n                                    alert(\"错误代码604，请告知小明\");\r\n                                }\r\n                            }\r\n                        });\r\n                        tableHtml += '</tr>';\r\n                    } else {\r\n                        // wrong format\r\n                        return false;\r\n                    }\r\n                });\r\n                tableHtml += '</tbody></table>';\r\n            } else {\r\n                // wrong format\r\n                return false;\r\n            }\r\n        });\r\n        $schedule.append(tableHtml);\r\n        $schedule.append('<div class=\"text-center\" style=\"margin-bottom: 15px;display: none;\">\\n' +\r\n            ' <button title=\"末尾增加一个时间段\" type=\"button\" class=\"btn btn-primary btn-sm\" name=\"chart-add\">\\n' +\r\n            '     <span class=\"glyphicon glyphicon-plus\"></span>\\n' +\r\n            ' </button>\\n' +\r\n            ' <button title=\"删去末尾的时间段\" type=\"button\" class=\"btn btn-primary btn-sm\" name=\"chart-delete\">\\n' +\r\n            '     <span class=\"glyphicon glyphicon-minus\"></span>\\n' +\r\n            ' </button></div>');\r\n    } else {\r\n        // wrong format\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * init popovers\r\n */\r\nfunction initPopovers() {\r\n    $(\"button#staff_list_add_btn\").popover({\r\n        content: \"一次只能新增一个空白团员\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', addStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"button#staff_attr_save_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', saveStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"button#staff_attr_del_btn\").popover({\r\n        content: \"请先在左侧团员列表选中其一\",\r\n        placement: \"top\",\r\n        trigger: \"manual\"\r\n    }).on('click', deleteStaff).on('blur', function () {\r\n        $(this).popover('hide');\r\n    });\r\n\r\n    $(\"button#schedule_history_btn\").popover({\r\n        content: scheduleHistoryHtml,\r\n        html: true,\r\n        placement: \"bottom\",\r\n        trigger: \"focus\"\r\n    });\r\n\r\n    $(\"button#staff_list_batch_leave\").popover({\r\n        content: \"对已选择团员进行：\"\r\n        + \"<div style='display: flex;justify-content: space-between;margin:0.25rem auto;'>\"\r\n        + \"<button class='btn btn-info' onclick='batchLeave(\\\"leave\\\");'>请假</button>\"\r\n        + \"<button class='btn btn-info' onclick='batchLeave(\\\"return\\\");'>销假</button></div>\",\r\n        html: true,\r\n        placement: 'top',\r\n        trigger: 'click'\r\n    });\r\n}\r\n\r\n/**\r\n * bind events\r\n */\r\nfunction bindEvents() {\r\n    let $schedule = $(\"div#schedule\");\r\n    // click on a staff button to read its attributes\r\n    $(\"div#staff_list\").children(\"div\").on('click', 'button', function (e) {\r\n        readStaffAttributes(e);\r\n    });\r\n\r\n    // filter staff\r\n    $(\"div#staff_list_filter\").find(\"input[name='options']\").on('change', filterStaff);\r\n\r\n    // search\r\n    $(\"input#staff_search\").on('focus', function () {\r\n        $(this).select();\r\n    }).on('change keydown', function (e) {\r\n        if (e.type === \"keydown\" && e.keyCode !== 13) return;\r\n        let $list = $(\"div#staff_list\").children(\"div\").children(\"button\");\r\n        let key = $(this).val().trim();\r\n        if (key === \"\") {\r\n            $list.show();\r\n        } else {\r\n            $list.hide().filter(\":contains(\" + key + \")\").show();\r\n        }\r\n    });\r\n    $schedule.on('focus', \"input#schedule_search\", function () {\r\n        $(this).select();\r\n    }).on('change keydown', \"input#schedule_search\", function (e) {\r\n        if (e.type === \"keydown\" && e.keyCode !== 13) return;\r\n        let $cell = $(\"div#schedule\").find(\"tbody tr td\");\r\n        let key = $(this).val().trim();\r\n        if (key === \"\") {\r\n            $cell.removeClass(\"schedule-search-result\");\r\n        } else {\r\n            $cell.removeClass(\"schedule-search-result\").filter(\":contains(\" + key + \")\").addClass(\"schedule-search-result\");\r\n        }\r\n    });\r\n\r\n    // modal\r\n    $('div#modal_add_name').on('show.bs.modal', function () {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('div#modal_add_name').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    }).on(\"shown.bs.modal\", function () {\r\n        $(\"input#modal_add_name_input\").focus();\r\n    });\r\n    $(\"input#modal_add_name_input\").on('keydown', function (e) {\r\n        if (e.keyCode === 13) {\r\n            addName();\r\n        }\r\n    });\r\n    $('div#modal_authorize').on('show.bs.modal', function () {\r\n        // 关键代码，如没将modal设置为 block，则$modala_dialog.height() 为零\r\n        $(this).css('display', 'block');\r\n        let modalHeight = $(window).height() / 2 - $('div#modal_authorize').find('.modal-dialog').height() / 2;\r\n        $(this).find('.modal-dialog').css({\r\n            'margin-top': modalHeight\r\n        });\r\n    }).on(\"shown.bs.modal\", function () {\r\n        $(\"input#modal_authorize_input\").focus();\r\n    });\r\n    $(\"input#modal_authorize_input\").on('keydown', function (e) {\r\n        if (e.keyCode === 13) {\r\n            checkAuth();\r\n        }\r\n    });\r\n\r\n    // row/chart add&delete\r\n    $schedule.on('click', \"[name='row-add']\", function () {\r\n        let $table = $(this).parentsUntil('div#schedule').filter('table');\r\n        let count = $table.find('tbody tr').length;\r\n        if (count >= 7) return;// max support 7 rows per chart\r\n        $table.append('<tr><th scope=\"row\">' + String.fromCharCode(65 + count) + '队</th><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>');\r\n        resizeSVG();\r\n    }).on('click', \"[name='row-delete']\", function () {\r\n        let $tr = $(this).parentsUntil('div#schedule').filter('table').find('tbody tr');\r\n        let count = $tr.length;\r\n        if (count <= 1) return;// min support 1 row per chart\r\n        $tr.eq(count - 1).remove();\r\n        resizeSVG();\r\n    }).on('click', \"[name='chart-add']\", function () {\r\n        let count = $(\"div#schedule\").children(\"table\").length;\r\n        if (count >= 10) return;// max support 10 charts\r\n        $(\"<table class=\\\"table table-bordered text-center\\\">\\n\" +\r\n            \"<thead>\\n\" +\r\n            \"<tr>\\n\" +\r\n            \"    <th class=\\\"bg-success\\\">\" + firstBattleTime.add(\"m\", battleInterval * count).Format(\"hh:mm\") + \"\\n\" +\r\n            \"        <span class=\\\"pull-right\\\">\\n\" +\r\n            \"            <button title=\\\"在该时间段末尾增加一个团\\\"  type=\\\"button\\\" class=\\\"btn btn-info btn-xxs\\\" name=\\\"row-add\\\">\\n\" +\r\n            \"                <span class=\\\"glyphicon glyphicon-plus\\\"></span>\\n\" +\r\n            \"            </button>\\n\" +\r\n            \"            <button title=\\\"将该时间段末尾的团删去\\\" type=\\\"button\\\" class=\\\"btn btn-info btn-xxs\\\" name=\\\"row-delete\\\">\\n\" +\r\n            \"                <span class=\\\"glyphicon glyphicon-minus\\\"></span>\\n\" +\r\n            \"            </button>\\n\" +\r\n            \"        </span>\\n\" +\r\n            \"    </th>\\n\" +\r\n            \"    <th class=\\\"text-center\\\" colspan=\\\"4\\\">光</th>\\n\" +\r\n            \"    <th class=\\\"text-center\\\" colspan=\\\"4\\\">暗</th>\\n\" +\r\n            \"</tr>\\n\" +\r\n            \"</thead>\\n\" +\r\n            \"<tbody>\\n\" +\r\n            \"<tr>\\n\" +\r\n            \"    <th scope=\\\"row\\\">A队</th>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"    <td></td>\\n\" +\r\n            \"</tr>\\n\" +\r\n            \"</tbody>\\n\" +\r\n            \"</table>\").insertBefore(\"div#schedule>div\");\r\n        resizeSVG();\r\n    }).on('click', \"[name='chart-delete']\", function () {\r\n        let $table = $(\"div#schedule\").children(\"table\");\r\n        let count = $table.length;\r\n        if (count <= 1) return;// min support 1 chart\r\n        $table.eq(count - 1).remove();\r\n        resizeSVG();\r\n    });\r\n\r\n    // export\r\n    $(\"button#export_btn\").on(\"click\", function () {\r\n        html2canvas($(\"div#schedule\").get(0)).then(function (canvas) {\r\n            $(\"img#screen_shot_img\").attr(\"src\", canvas.toDataURL());\r\n        });\r\n        $(\"div#modal_img\").modal(\"show\");\r\n    });\r\n\r\n    // load schedule history\r\n    $(\".page-header\").on(\"click\", \"a.schedule-history\", function () {\r\n        let id = $(this).attr(\"data-id\");\r\n        requestSchedule(id, null);\r\n    });\r\n\r\n    // batch leave & return\r\n    $(\"button#staff_list_batch_leave\").on('click', function () {\r\n        if ($(this).attr(\"data-clicked\") === \"0\") {\r\n            $(\"div#staff_list\").children('div').children('button').append(\" <input class='batch_leave' type='checkbox'>\");\r\n            // stop propagation of checkboxes\r\n            $(\"input.batch_leave\").on(\"click\", function (e) {\r\n                e.stopPropagation();\r\n            });\r\n            $(this).text(\"退出管理\");\r\n            $(this).attr(\"data-clicked\", \"1\");\r\n        } else {\r\n            $(\"input.batch_leave\").remove();\r\n            $(this).text(\"批量管理\");\r\n            $(this).attr(\"data-clicked\", \"0\");\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * experience. have none access to save changes\r\n */\r\nfunction experience() {\r\n    sessionStorage.authorized = \"false\";\r\n    $(\"div#modal_authorize\").modal('hide');\r\n}\r\n\r\n/**\r\n * check auth.\r\n */\r\nfunction checkAuth() {\r\n    let code = $(\"input#modal_authorize_input\").val().trim();\r\n    let $enter = $(\"button#btn_auth_enter\");\r\n    // clear help block\r\n    let $help = $(\"span#helpBlock\");\r\n\r\n    $.post(\"php/AuthCheck.php\", {\r\n        \"auth\": code\r\n    }, function (data, status) {\r\n        if (status === \"success\") {\r\n            // success message\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // correct auth code\r\n                if (parseInt(json.data) === 1) {\r\n                    $help.html('<b>团员授权</b>：只可保存团员区改动');\r\n                    $enter.prop(\"disabled\", false);\r\n                } else if (parseInt(json.data) === 2) {\r\n                    $help.html('<b>团长授权</b>：可保存所有改动');\r\n                    $enter.prop(\"disabled\", false);\r\n                }\r\n            } else if (json.code === 2) {\r\n                // wrong auth code\r\n                $help.text('授权码不对，无保存权限，请联系小明');\r\n                $enter.prop(\"disabled\", true);\r\n            } else {\r\n                $.toast({\r\n                    heading: \"error\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * authorize. set session authorization and enter.\r\n */\r\nfunction authorize() {\r\n    sessionStorage.auth = $(\"input#modal_authorize_input\").val().trim();\r\n    sessionStorage.authorized = \"true\";\r\n    $(\"div#modal_authorize\").modal('hide');\r\n}\r\n\r\n/**\r\n * when a staff button is clicked, load his attributes\r\n * @param e event object\r\n */\r\nfunction readStaffAttributes(e) {\r\n    let id = parseInt(e.target.getAttribute(\"data-id\"));\r\n    $(\"div#staff_attr_panel\").attr(\"data-id\", id);\r\n    // new staff\r\n    if (id === 0) {\r\n        // reset attributes group\r\n        resetStaffAttributesPanel();\r\n        return;\r\n    }\r\n    // read local attributes\r\n    let staff = staticLocalStaffList[id - 1];\r\n    if (parseInt(staff.id) === id) {\r\n        // main attributes\r\n        let index_namelist = staticNameList.indexOf(staff.name);\r\n        $(\"select#staff_attr_name_select\").val(index_namelist);\r\n        $(\"input#staff_attr_career_input\").val(staff.career);\r\n        $(\"select#staff_attr_type_select\").val(staff.type);\r\n        $(\"input#staff_attr_absence_check\").prop(\"checked\", staff.absence === '1');\r\n        // other attributes\r\n        $(\"div#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(staff.attack - 1).addClass(\"active\");\r\n        $(\"div#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(staff.control - 1).addClass(\"active\");\r\n        $(\"div#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(staff.element - 1).addClass(\"active\");\r\n    } else {\r\n        // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n        alert(\"错误代码600，请告知小明\");\r\n    }\r\n}\r\n\r\n/**\r\n * reset staff attributes panel\r\n */\r\nfunction resetStaffAttributesPanel() {\r\n    $(\"select#staff_attr_name_select\").val(-1);\r\n    $(\"input#staff_attr_career_input\").val(\"\");\r\n    $(\"select#staff_attr_type_select\").val(0);\r\n    $(\"input#staff_attr_absence_check\").prop(\"checked\", false);\r\n    $(\"div#staff_attr_other_attack\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n    $(\"div#staff_attr_other_control\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n    $(\"div#staff_attr_other_element\").children(\"label\").removeClass(\"active\").eq(0).addClass(\"active\");\r\n}\r\n\r\n/**\r\n * load staff list on the left from local json\r\n */\r\nfunction loadStaffList(staffList) {\r\n    let $staff_list = $(\"div#staff_list\").children(\"div\");\r\n    $staff_list.empty();\r\n    $.each(staffList, function (index, item) {\r\n        // add to nameList\r\n        if (staticNameList.indexOf(item.name) === -1) {\r\n            staticNameList.push(item.name);\r\n        }\r\n\r\n        // load staff\r\n        let elementNode = document.createElement(\"button\");\r\n        elementNode.setAttribute(\"type\", \"button\");\r\n        elementNode.setAttribute(\"data-id\", item.id);\r\n        elementNode.className = \"btn btn-default\";\r\n        elementNode.innerHTML = item.name + item.career;\r\n        if (item.type === '1') {\r\n            elementNode.className += \" career-c\";\r\n        } else if (item.type === '2') {\r\n            elementNode.className += \" career-assist\";\r\n        } else if (item.type === '3') {\r\n            elementNode.className += \" career-priest\";\r\n        }\r\n        if (item.absence === '1') {\r\n            elementNode.className += \" career-absence\";\r\n        }\r\n        $staff_list.append(elementNode);\r\n    });\r\n    resizeSVG();\r\n    loadNameList();\r\n    resetStaffAttributesPanel();\r\n}\r\n\r\n/**\r\n * create name select widget from static list\r\n */\r\nfunction loadNameList() {\r\n    let $name_select = $(\"select#staff_attr_name_select\");\r\n    $name_select.empty();\r\n    $name_select.append(new Option(\"称谓\", \"-1\"));\r\n    $.each(staticNameList, function (index, item) {\r\n        $name_select.append(new Option(item, index));\r\n    });\r\n}\r\n\r\n/**\r\n * check '.in-schedule' from schedule and check '.absence' from staff list\r\n */\r\nfunction loadCheck() {\r\n    let $cell = $(\"div#schedule\").find(\"tbody tr td\");\r\n    let $staff = $(\"div#staff_list\").children(\"div\").find(\"button\");\r\n    // reset in-schedule\r\n    $staff.removeClass(\"in-schedule\");\r\n    $cell.each(function () {\r\n        let text = $(this).text();\r\n        if (text === null || text === \"\" || text === \"空\") return;\r\n        let $target = $staff.filter(\":contains(\" + text + \")\");\r\n        let $current = $(this);\r\n        $target.each(function () {\r\n            if ($(this).text() === text) {\r\n                if ($(this).hasClass(\"career-absence\")) {\r\n                    $current.removeAttr(\"data-id\").removeAttr(\"data-name\").text(\"\");\r\n                } else if (!$(this).hasClass(\"in-schedule\")) {\r\n                    $(this).addClass(\"in-schedule\");\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * filter staff list according to the checkboxes\r\n */\r\nfunction filterStaff() {\r\n    let filterConditions = [\".career-c\", \".career-assist\", \".career-priest\", \".in-schedule\", \".career-absence\"];\r\n\r\n    let $staff_list = $(\"div#staff_list\");\r\n    // show all\r\n    $staff_list.find(\"button[data-id]\").show();\r\n\r\n    // filter hide\r\n    let $filterInputs = $(\"div#staff_list_filter\").find(\"input\");\r\n    $filterInputs.each(function () {\r\n        let index = parseInt($(this).attr(\"data-filter\"));\r\n        if (!$(this).parent().hasClass('active')) {\r\n            // hide\r\n            $(\"div#staff_list\").find(filterConditions[index - 1]).hide();\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * add a blank staff button\r\n */\r\nfunction addStaff() {\r\n    let $btn_list = $(\"div#staff_list\").children('div');\r\n    let increment = 0;\r\n    let exist = $btn_list.children(\"button\").is(\"[data-id=\" + increment + \"]\");\r\n    if (exist) {\r\n        $(\"button#staff_list_add_btn\").popover('show');\r\n        return;\r\n    }\r\n    let elementNode = document.createElement(\"button\");\r\n    elementNode.setAttribute(\"type\", \"button\");\r\n    elementNode.setAttribute(\"data-id\", increment.toString());\r\n    elementNode.className = \"btn btn-default\";\r\n    elementNode.innerHTML = \"新增人员\";\r\n    $btn_list.append(elementNode);\r\n}\r\n\r\n/**\r\n * add a new staff name to static list\r\n * and reload the name select widget\r\n */\r\nfunction addName() {\r\n    let $input = $(\"input#modal_add_name_input\");\r\n    let name = $input.val().trim();\r\n    let $modal = $(\"div#modal_add_name\");\r\n    if (name === null || name === '') {\r\n        $modal.modal('hide');\r\n        return;\r\n    }\r\n    staticNameList.push(name);\r\n    loadNameList();\r\n    $(\"select#staff_attr_name_select\").val(staticNameList.length - 1);\r\n    $modal.modal('hide');\r\n    $input.val('');\r\n}\r\n\r\n/**\r\n * set absence in batch\r\n * @param type \"leave\" leave; \"return\" return\r\n */\r\nfunction batchLeave(type) {\r\n    let idList = [];\r\n    let $checkList = $(\"input.batch_leave:checked\").parent();\r\n    $checkList.each(function () {\r\n        idList.push($(this).attr(\"data-id\"));\r\n    });\r\n    let method = null;\r\n    if (type === \"leave\") {\r\n        method = \"batch_leave\";\r\n    } else {\r\n        method = \"batch_return\";\r\n    }\r\n\r\n    if (sessionStorage.authorized === \"true\") {\r\n        $.post(\"php/StaffAttr.php\", {\r\n            auth: sessionStorage.auth,\r\n            method: method,\r\n            idList: idList\r\n        }, function (data, status) {\r\n            if (status === \"success\") {\r\n                // success message\r\n                let json = JSON.parse(data);\r\n                if (json.code === 0) {\r\n                    // reload staff list\r\n                    requestStaff(loadCheck);\r\n                    $.toast({\r\n                        text: \"批量\" + (type === \"leave\" ? \"请假\" : \"销假\") + \"成功\",\r\n                        showHideTransition: 'fade',\r\n                        icon: \"success\"\r\n                    });\r\n                } else if (json.code === 5) {\r\n                    // alert NO AUTH\r\n                    $.toast({\r\n                        heading: \"权限不足\",\r\n                        text: \"需要团员以上权限才可操作，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"warning\"\r\n                    });\r\n                } else {\r\n                    $.toast({\r\n                        heading: \"批量\" + (type === \"leave\" ? \"请假\" : \"销假\") + \"失败\",\r\n                        text: json.msg,\r\n                        showHideTransition: 'fade',\r\n                        icon: \"error\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        $checkList.filter(\":not(.career-absence)\").addClass(\"career-absence\");\r\n\r\n        // alert NO AUTH\r\n        $.toast({\r\n            heading: \"无此权限\",\r\n            text: \"体验账号所做修改仅限于页面，不会提交到服务器，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n            showHideTransition: 'fade',\r\n            hideAfter: false,\r\n            icon: \"warning\"\r\n        });\r\n    }\r\n\r\n    $(\"button#staff_list_batch_leave\").popover('hide').click();\r\n}\r\n\r\n/**\r\n * save the attribute changes to local\r\n * and refresh the corresponding button\r\n */\r\nfunction saveStaff() {\r\n    let id = parseInt($(\"div#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"div#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $('button#staff_attr_save_btn').popover('show');\r\n        return;\r\n    }\r\n    // read staff\r\n    let data = {\r\n        \"method\": \"save\",\r\n        \"auth\": sessionStorage.auth,\r\n        \"id\": id,\r\n        \"name\": staticNameList[parseInt($(\"select#staff_attr_name_select\").val())],\r\n        \"career\": $(\"input#staff_attr_career_input\").val().trim(),\r\n        \"type\": parseInt($(\"select#staff_attr_type_select\").val()),\r\n        \"absence\": $(\"input#staff_attr_absence_check\").prop('checked'),\r\n        \"attack\": $(\"div#staff_attr_other_attack\").find('label.active').index() + 1,\r\n        \"control\": $(\"div#staff_attr_other_control\").find('label.active').index() + 1,\r\n        \"element\": $(\"div#staff_attr_other_element\").find('label.active').index() + 1\r\n    };\r\n\r\n    // submit changes\r\n    if (sessionStorage.authorized === \"true\") {\r\n        $.post(\"php/StaffAttr.php\", data, function (data, status) {\r\n            if (status === \"success\") {\r\n                // success message\r\n                let json = JSON.parse(data);\r\n                if (json.code === 0) {\r\n                    // reload staff list\r\n                    requestStaff(loadCheck);\r\n                    $.toast({\r\n                        text: \"保存成功\",\r\n                        showHideTransition: 'fade',\r\n                        icon: \"success\"\r\n                    });\r\n                } else if (json.code === 5) {\r\n                    // alert NO AUTH\r\n                    $.toast({\r\n                        heading: \"权限不足\",\r\n                        text: \"需要团员以上权限才可操作，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"warning\"\r\n                    });\r\n                } else {\r\n                    $.toast({\r\n                        heading: \"保存失败\",\r\n                        text: json.msg,\r\n                        showHideTransition: 'fade',\r\n                        icon: \"error\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        if (data.id === 0) {\r\n            // add to local json\r\n            data.id = Math.round(Math.random() * 100) + staticLocalStaffList.length;\r\n            staticLocalStaffList.push(data);\r\n            // refresh staff button\r\n            $staff_btn.attr(\"data-id\", data.id);\r\n        }\r\n        $staff_btn.text(data.name + data.career);\r\n        if (data.type === 1) {\r\n            $staff_btn.attr(\"class\", \"btn btn-default career-c\");\r\n        } else if (data.type === 2) {\r\n            $staff_btn.attr(\"class\", \"btn btn-default career-assist\");\r\n        } else if (data.type === 3) {\r\n            $staff_btn.attr(\"class\", \"btn btn-default career-priest\");\r\n        } else if (data.type === 0) {\r\n            $staff_btn.attr(\"class\", \"btn btn-default\");\r\n        }\r\n        if (data.absence) {\r\n            $staff_btn.addClass(\"career-absence\");\r\n        }\r\n\r\n        // alert NO AUTH\r\n        $.toast({\r\n            heading: \"无此权限\",\r\n            text: \"体验账号所做修改仅限于页面，不会提交到服务器，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n            showHideTransition: 'fade',\r\n            hideAfter: false,\r\n            icon: \"warning\"\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * delete the corresponding staff button both from page and static json\r\n */\r\nfunction deleteStaff() {\r\n    let id = parseInt($(\"div#staff_attr_panel\").attr(\"data-id\"));\r\n    let $staff_btn = $(\"div#staff_list\").children('div').children(\"button[data-id=\" + id + \"]\");\r\n    if (id === -1 || !$staff_btn.is('button')) {// no staff selected or btn was deleted\r\n        // pop over\r\n        $(\"button#staff_attr_del_btn\").popover('show');\r\n        return;\r\n    }\r\n\r\n    if (id === 0) {// newly added\r\n        $staff_btn.remove();\r\n        return;\r\n    }\r\n    let textDeleted = $staff_btn.text();\r\n    // submit changes\r\n    if (sessionStorage.authorized === \"true\") {\r\n        $.post(\"php/StaffAttr.php\", {\r\n            \"method\": \"delete\",\r\n            \"id\": id,\r\n            \"auth\": sessionStorage.auth\r\n        }, function (data, status) {\r\n            if (status === \"success\") {\r\n                // success message\r\n                let json = JSON.parse(data);\r\n                if (json.code === 0) {\r\n                    // reload staff list\r\n                    requestStaff(loadCheck);\r\n                    $.toast({\r\n                        heading: \"删除成功\",\r\n                        text: \"已删除<b>\" + textDeleted + \"</b>，<a onclick=\\\"undoDeleteStaff(\" + id + \");$(this).siblings(\\\".close-jq-toast-single\\\").click();\\\">撤销删除</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"success\"\r\n                    });\r\n                } else if (json.code === 5) {\r\n                    // alert NO AUTH\r\n                    $.toast({\r\n                        heading: \"权限不足\",\r\n                        text: \"需要团员以上权限才可操作，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"warning\"\r\n                    });\r\n                } else {\r\n                    $.toast({\r\n                        heading: \"删除失败\",\r\n                        text: json.msg,\r\n                        showHideTransition: 'fade',\r\n                        icon: \"error\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        $staff_btn.remove();\r\n        // delete from static json\r\n        if (parseInt(staticLocalStaffList[id - 1].id) === id) {\r\n            staticLocalStaffList.splice(id - 1, 1);\r\n        } else {\r\n            // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n            alert(\"错误代码602，请告知小明\");\r\n        }\r\n        // alert NO AUTH\r\n        $.toast({\r\n            heading: \"无此权限\",\r\n            text: \"体验账号所做修改仅限于页面，不会提交到服务器，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n            showHideTransition: 'fade',\r\n            hideAfter: false,\r\n            icon: \"warning\"\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * recover the staff just deleted\r\n * @param idDeleted id of the deleted staff\r\n */\r\nfunction undoDeleteStaff(idDeleted) {\r\n    $.post(\"php/StaffAttr.php\", {\r\n        \"method\": \"undo\",\r\n        \"id\": idDeleted,\r\n        \"auth\": sessionStorage.auth\r\n    }, function (data, status) {\r\n        if (status === \"success\") {\r\n            // success message\r\n            let json = JSON.parse(data);\r\n            if (json.code === 0) {\r\n                // reload staff list\r\n                requestStaff(loadCheck);\r\n                $.toast({\r\n                    text: \"已恢复\",\r\n                    showHideTransition: 'fade',\r\n                    icon: \"info\"\r\n                });\r\n            } else if (json.code === 5) {\r\n                // alert NO AUTH\r\n                $.toast({\r\n                    heading: \"权限不足\",\r\n                    text: \"需要团员以上权限才可操作，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                    showHideTransition: 'fade',\r\n                    hideAfter: false,\r\n                    icon: \"warning\"\r\n                });\r\n            } else {\r\n                $.toast({\r\n                    heading: \"恢复失败\",\r\n                    text: json.msg,\r\n                    showHideTransition: 'fade',\r\n                    icon: \"error\"\r\n                });\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * premium auth. save schedule changes to local chart.txt file\r\n */\r\nfunction saveSchedule() {\r\n    // save schedule\r\n    if (sessionStorage.authorized === \"true\") {\r\n        let content = extractSchedule();\r\n        $.post(\"php/ScheduleSL.php\", {\r\n            \"method\": \"save\",\r\n            \"content\": content,\r\n            \"auth\": sessionStorage.auth\r\n        }, function (data, status) {\r\n            if (status === \"success\") {\r\n                // success message\r\n                let json = JSON.parse(data);\r\n                if (json.code === 0) {\r\n                    $.toast({\r\n                        text: \"保存成功\",\r\n                        showHideTransition: 'fade',\r\n                        icon: \"success\"\r\n                    });\r\n                } else if (json.code === 5) {\r\n                    // alert NO AUTH\r\n                    $.toast({\r\n                        heading: \"无此权限\",\r\n                        text: \"只有团长权限可以保存排表，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n                        showHideTransition: 'fade',\r\n                        hideAfter: false,\r\n                        icon: \"warning\"\r\n                    });\r\n                } else {\r\n                    $.toast({\r\n                        heading: \"保存失败\",\r\n                        text: json.msg,\r\n                        showHideTransition: 'fade',\r\n                        icon: \"error\"\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        // alert NO AUTH\r\n        $.toast({\r\n            heading: \"无此权限\",\r\n            text: \"体验账号所做修改仅限于页面，不会提交到服务器，<a onclick='$(\\\"div#modal_authorize\\\").modal(\\\"show\\\");$(this).siblings(\\\".close-jq-toast-single\\\").click();'>重新登录</a>\",\r\n            showHideTransition: 'fade',\r\n            hideAfter: false,\r\n            icon: \"warning\"\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * extract the whole schedule\r\n * @returns {string} nested array of the schedule\r\n */\r\nfunction extractSchedule() {\r\n    let $schedule = $(\"div#schedule\");\r\n    let scheduleArray = [];\r\n    $schedule.find(\"table\").each(function () {\r\n        let $table = $(this);\r\n        // each table is one period\r\n        let periodArray = [];\r\n        $table.find(\"tbody tr\").each(function () {\r\n            let $tr = $(this);\r\n            // each tr is one team\r\n            let staffArray = [];\r\n            $tr.find(\"td\").each(function () {\r\n                let $td = $(this);\r\n                // each td is one staff\r\n                let id = $td.attr(\"data-id\");\r\n                let staff = staticLocalStaffList[id - 1];\r\n                staffArray.push(id && id > 1 && parseInt(staff.deleted) === 0 ? id : 0);\r\n            });\r\n            periodArray.push(\"[\" + staffArray.toString() + \"]\");\r\n        });\r\n        scheduleArray.push(\"[\" + periodArray.toString() + \"]\");\r\n    });\r\n    return \"[\" + scheduleArray.toString().toString() + \"]\";\r\n}\r\n\r\n/**\r\n * make the corresponding dom draggable\r\n * @param $object jquery selector, object to be dragged\r\n * @param $handle the move handle\r\n */\r\nfunction makeDraggable($object, $handle) {\r\n    if (!$object instanceof jQuery) {\r\n        return;\r\n    }\r\n    let isMove = false;\r\n    let X, Y;\r\n    $handle.on('mousedown', function (e) {\r\n        isMove = true;\r\n        X = e.pageX - parseInt($object.css(\"left\"));\r\n        Y = e.pageY - parseInt($object.css(\"top\"));\r\n    });\r\n    $(document).on('mousemove', function (e) {\r\n        if (isMove) {\r\n            let left = e.pageX - X;\r\n            let top = e.pageY - Y;\r\n            $object.css({left: left, top: top});\r\n        }\r\n    }).on('mouseup', function () {\r\n        isMove = false;\r\n    });\r\n}\r\n\r\n/**\r\n * when nodes be added to or removed from DOM and the height has changed,\r\n * the svg needs to resize\r\n */\r\nfunction resizeSVG() {\r\n    $('.line').css({width: document.body.scrollWidth, height: document.body.scrollHeight});\r\n}\r\n\r\n/**\r\n * when drag event happening on a staff button, draw a line from start to end\r\n * if the dragging ends within the schedule chart, fill the cell with the staff\r\n *\r\n * add support for exchanging staffs in the schedule\r\n */\r\nfunction bindDrawLine() {\r\n    // reinitialize svg width & height\r\n    $('.line').css({width: document.body.scrollWidth, height: document.body.scrollHeight});\r\n    // bind\r\n    let isDraw = false, isDrop = false, isExchange = false;\r\n    let $svg = $('svg');\r\n    // button\r\n    let staffId;\r\n    // table\r\n    let $td;\r\n    // pick staff\r\n    let $buttons = $(\"div#staff_list\").children('div');\r\n    $buttons.on('mousedown', 'button', function (e) {\r\n        // unlock drawing\r\n        isDraw = true;\r\n        // read staff id\r\n        staffId = parseInt($(e.target).attr('data-id'));\r\n        // draw a line\r\n        $svg.children('line').attr({x1: e.pageX, y1: e.pageY, x2: e.pageX, y2: e.pageY});\r\n    });\r\n    let $schedule = $(\"div#schedule\");\r\n    $schedule.on(\"mousedown\", \"table tr td\", function (e) {\r\n        // unlock drawing\r\n        isDraw = true;\r\n        // exchange flag\r\n        isExchange = true;\r\n        // read staff\r\n        $td = $(e.target);\r\n        // draw a line\r\n        $svg.children('line').attr({x1: e.pageX, y1: e.pageY, x2: e.pageX, y2: e.pageY});\r\n    });\r\n    // draw line\r\n    $(document).on('mousemove', function (e) {\r\n        if (isDraw) {\r\n            if (!$svg.is(':visible')) {\r\n                $svg.show();\r\n            }\r\n            // draw a line\r\n            $svg.children('line').attr({x2: e.pageX, y2: e.pageY});\r\n        }\r\n    }).on('mouseup', function () {\r\n        if (isDraw) {\r\n            isDraw = false;\r\n            $svg.hide();\r\n\r\n            // allow drop\r\n            isDrop = true;\r\n            setTimeout(function () {\r\n                isDrop = false;\r\n            }, 50);\r\n        }\r\n    });\r\n    // drop staff\r\n    $schedule.on('mouseover', 'table tr td', function () {\r\n        if (isDrop) {\r\n            if (isExchange) {\r\n                // exchange\r\n                let staff_id = $td.attr(\"data-id\");\r\n                let staff_name = $td.attr(\"data-name\");\r\n                let staff_text = $td.text();\r\n                let $target = $(this);\r\n                let this_id = $target.attr(\"data-id\");\r\n                let this_name = $target.attr(\"data-name\");\r\n                let this_text = $target.text();\r\n                $td.attr(\"data-id\", !this_id ? \"\" : this_id);\r\n                $td.attr(\"data-name\", !this_name ? \"\" : this_name);\r\n                $td.text(!this_text ? \"\" : this_text);\r\n                $target.attr(\"data-id\", !staff_id ? \"\" : staff_id);\r\n                $target.attr(\"data-name\", !staff_name ? \"\" : staff_name);\r\n                $target.text(!staff_text ? \"\" : staff_text);\r\n                // reset\r\n                isExchange = false;\r\n                // mark duplication\r\n                markDuplicate(false, $td);\r\n                markDuplicate(false, $target);\r\n                return;\r\n            }\r\n            let staff = staticLocalStaffList[staffId - 1];\r\n            if (parseInt(staff.id) === staffId) {\r\n                let id_replaced = parseInt($(this).attr(\"data-id\"));\r\n                let $staff_list = $(\"div#staff_list\");\r\n                // remove duplication\r\n                if (staff.name !== \"空\") {\r\n                    let $contain = $(\"div#schedule\").find(\"tbody tr td\").filter('[data-id=\"' + staffId + '\"]');\r\n                    $contain.each(function () {\r\n                        $(this).removeAttr(\"data-id\").removeAttr(\"data-name\").text(\"\");\r\n                    });\r\n                }\r\n                // fill in the cell\r\n                $(this).attr('data-id', staffId).attr('data-name', staff.name).text(staff.name + staff.career);\r\n                // set staff to '.in-schedule'\r\n                let $staff_in = $staff_list.find('button[data-id=\"' + staffId + '\"]');\r\n                if (!$staff_in.hasClass('in-schedule') && staff.name !== \"空\") {\r\n                    $staff_in.addClass('in-schedule');\r\n                    // hide\r\n                    if ($(\"div#staff_list_filter\").find('input[data-filter=4]').prop(\"checked\") === false) {\r\n                        $staff_in.hide();\r\n                    }\r\n                }\r\n                // consider REPLACE\r\n                if (id_replaced > 1) {\r\n                    let $contain = $staff_list.find('button[data-id=\"' + id_replaced + '\"]');\r\n                    $contain.each(function () {\r\n                        $(this).removeClass(\"in-schedule\").show();\r\n                    })\r\n                }\r\n            } else {\r\n                // Error 60x:载入顺序与列表顺序不一致，需要手动查找定位（一般不会出现）\r\n                alert(\"错误代码603，请告知小明\");\r\n            }\r\n            isDrop = false;\r\n            // check duplication partly\r\n            markDuplicate(false, $(this));\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * check duplication in schedule\r\n * @param scale boolean. true:wholly, false:partly. if false, a root object is needed\r\n */\r\nfunction markDuplicate(scale) {\r\n    if (scale) {\r\n\r\n    } else {\r\n        if (typeof arguments[1] === \"object\") {\r\n            // recover\r\n            let $obj = arguments[1];\r\n            let $td = $obj.parentsUntil('table').find('td');\r\n            $td.css('color', '');\r\n            // check\r\n            let map = {};\r\n            $.each($td, function () {\r\n                let key = $(this).attr('data-name');\r\n                if (key !== \"空\" && !!key) {\r\n                    if (typeof map[key] === \"undefined\") {\r\n                        map[key] = 1;// first met\r\n                    } else if (map[key] === 1) {\r\n                        $td.filter('[data-name=' + key + ']').css('color', 'red');\r\n                        map[key] = 2;// handled\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            // Error 70x:参数传递错误\r\n            alert(\"错误代码701，请告知小明\");\r\n        }\r\n    }\r\n}\r\n\r\n"]}